---
title: "Apply: MuSyC Model -- KCNQ Conductance"
description: Demonstrate the MuSyC_model to analyze the interaction between
  voltage and small molecules interact modulate conductance through the KCNQ2
  voltage gated potassium channel.
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Apply: MuSyC Model -- KCNQ Conductance}
  %\VignetteEncoding{UTF-8}
---







# Re-analysis Figure 1 of (Li, et al., 2021) Molecular Basis for Ligand Activation of the Human KCNQ2 Channel

KCNQ2 is a voltage gated potassium channel important for re-establishing neuronal homeostasis following an action potential. Dis-regulation of channels in the KCNQ family can cause epilepsy, tinnitus, and depression. While there has been sustained interest in developing small-molecule based therapeutics targeting KCNQ2, the only FDA approved drug that targets KCNQ2, retigabine, was given a black-box warning due to unwanted side-effects, even though it was effective at treating epilepsy. Excitingly there has been recent progress in using Cryo-EM to structurally characterize ion channels including KCNQ2, which promise to support structure-based drug design.

Recently, [@Li2021-ef] used Cryo-EM to characterize the structure of KCNQ2 in complex with retigabine, which interacts in the membrane on the outside of the pore, and ztz240, which interacts with the voltage sensor domain. To relate the structure and function, [@Li2021-ef] measured conductance as a function of voltage (G-V curves) in the presence of varying doses of retigabine and ztz240 using whole cell patch-clamp electrophysiology in Chinese hamster ovary (CHO)-K1 cells overexpressing KCNQ2. Both compounds are thought to be agonists, that is with increasing concentration of drug, less negative voltages are required to open the channel.

In this case study, the aim is to re-analyze the effects of retigabine and ztz240 using the data collected in [@Li2021-ef] and presented in panels B and D of figure 1. A key idea is to recognize that voltage and drug treatment can be thought of independent perturbations and the drug effect can be framed as characterizing the interaction between these perturbations.

To begin, we will load the data,


```
## # A tibble: 1,856 × 6
##    treatment dose_uM is_control voltage replica   conductance
##    <chr>       <dbl> <lgl>        <dbl> <chr>           <dbl>
##  1 ztz240         10 TRUE           -90 replica_1      0.0403
##  2 ztz240         10 TRUE           -90 replica_2      0.0632
##  3 ztz240         10 TRUE           -90 replica_3      0.0200
##  4 ztz240         10 TRUE           -90 replica_4      0.0404
##  5 ztz240         10 TRUE           -90 replica_5      0.0175
##  6 ztz240         10 TRUE           -80 replica_1      0.0469
##  7 ztz240         10 TRUE           -80 replica_2      0.0682
##  8 ztz240         10 TRUE           -80 replica_3      0.0345
##  9 ztz240         10 TRUE           -80 replica_4      0.0574
## 10 ztz240         10 TRUE           -80 replica_5      0.0339
## # ℹ 1,846 more rows
```
And reproduce the their figures

<div class="figure" style="text-align: center">
<img src="apply_MuSyC_KCNQ_files/reproduce-fig1-1.png" alt="plot of chunk reproduce-fig1" width="100%" />
<p class="caption">plot of chunk reproduce-fig1</p>
</div>






```r
model_conductance <- BayesPharma::sigmoid_model(
  data = model_data,
  formula = BayesPharma::sigmoid_agonist_formula(
    treatment_variable = "voltage",
    treatment_units = "mV",
    response_variable = "conductance",
    response_units = "% Gmax",
    predictors = 0 + treatment:doselabel),
  prior = BayesPharma::sigmoid_agonist_prior(
    ec50 = brms::prior(normal(-0.2, 1), nlpar = "ec50"),
    hill = brms::prior(normal(3, 2), nlpar = "hill", lb = 1)),
  cores = 4)
```

```
## Warning in .local(object, ...): some chains had errors; consider specifying
## chains = 1 to debug
```


```r
model_conductance |>
  BayesPharma::plot_prior_posterior_densities()
```

```
## 
## SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: Rejecting initial value:
## Chain 1:   Error evaluating the log probability at the initial value.
## Chain 1: Exception: lb_free: Lower bounded variable is 0, but must be greater than or equal to 1 (in 'anon_model', line 40, column 2 to column 33)
## Chain 1: 
## Chain 1: Initialization between (-2, 2) failed after 100 attempts. 
## Chain 1:  Try specifying initial values, reducing ranges of constrained values, or reparameterizing the model.
## Error in eval(expr, envir, enclos) : Initialization failed.
## character(0)
```

```
## Error: Don't know how to transform an object of class 'stanfit' to any supported draws format.
```


```r
model_conductance |>
  BayesPharma::plot_posterior_draws()
```

```
## Error: The model does not contain posterior draws.
```
Fit MuSyC Model


```
## Warning in BayesPharma::MuSyC_model(data = model_data, formula = BayesPharma::MuSyC_formula(treatment_1_variable = "voltage", : There needs to be variable for treatment 2 'log_dose' as a column in the input 'data' data.frame
```

```
## Error in `dplyr::mutate()`:
## ℹ In argument: `logd2scale = mean(.data[["log_dose"]])`.
## Caused by error in `.data[["log_dose"]]`:
## ! Column `log_dose` not found in `.data`.
```

```
## Error in stanc(file = file, model_code = model_code, model_name = model_name, : 0
## 
## Semantic error in 'string', line 84, column 24 to column 27:
## 
## Identifier 'Inf' not in scope.
```

Join the conductance model with the dose information to model how the voltage
dependence depends on the drug dose

```
## Error: The model does not contain posterior draws.
```

```
## Error in eval(expr, envir, enclos): object 'data_conductance_by_voltage' not found
```



```
## Error in ggplot2::ggplot(data = data_conductance_by_voltage): object 'data_conductance_by_voltage' not found
```

```
## function (x, y, ...) 
## UseMethod("plot")
## <bytecode: 0x7f8a9ac0dc48>
## <environment: namespace:base>
```


```
## Warning: The largest R-hat is 1.53, indicating chains have not mixed.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#r-hat
```

```
## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#bulk-ess
```

```
## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#tail-ess
```



```
## Warning: Parts of the model have not converged (some Rhats are > 1.05). Be
## careful when analysing the results! We recommend running more iterations and/or
## setting stronger priors.
```

```
##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: conductance ~ sigmoid(sigmoid(Eec50, Ehill, Etop, Ebottom, logdose), sigmoid(Hec50, Hhill, Htop, Hbottom, logdose), vtop, vbottom, voltage) 
##          vtop ~ 1
##          vbottom ~ 1
##          Eec50 ~ 0 + treatment
##          Ehill ~ 0 + treatment
##          Etop ~ 0 + treatment
##          Ebottom ~ 0 + treatment
##          Hec50 ~ 0 + treatment
##          Hhill ~ 0 + treatment
##          Htop ~ 0 + treatment
##          Hbottom ~ 0 + treatment
##    Data: model_data (Number of observations: 928) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
## vtop_Intercept                  0.71      0.42    -0.01     0.96 1.53        7
## vbottom_Intercept               0.24      0.41    -0.01     0.96 1.53        7
## Eec50_treatmentretigabine      -5.77      0.07    -5.92    -5.64 1.00     2764
## Eec50_treatmentztz240          -5.46      0.06    -5.57    -5.35 1.02      602
## Ehill_treatmentretigabine      -1.61      0.27    -2.15    -1.11 1.00     2531
## Ehill_treatmentztz240          -1.47      0.18    -1.86    -1.15 1.00     2332
## Etop_treatmentretigabine       -0.19      0.02    -0.22    -0.15 1.00     2523
## Etop_treatmentztz240           -0.14      0.01    -0.15    -0.12 1.00     4043
## Ebottom_treatmentretigabine    -0.43      0.01    -0.44    -0.41 1.00     3515
## Ebottom_treatmentztz240        -0.48      0.02    -0.53    -0.44 1.02     1684
## Hec50_treatmentretigabine      -5.02      2.77   -10.80    -0.36 1.47        8
## Hec50_treatmentztz240          -6.02      1.55    -9.17    -4.72 1.53        7
## Hhill_treatmentretigabine       1.28      0.74     0.25     3.00 1.00     2885
## Hhill_treatmentztz240           1.39      0.77     0.17     2.81 1.53        7
## Htop_treatmentretigabine        2.69      3.62    -3.23     8.24 1.53        7
## Htop_treatmentztz240            3.27      4.61    -5.31     8.58 1.53        7
## Hbottom_treatmentretigabine     3.00      0.09     2.80     3.17 1.01     3510
## Hbottom_treatmentztz240         2.88      0.11     2.69     3.13 1.29       10
##                             Tail_ESS
## vtop_Intercept                    30
## vbottom_Intercept                 28
## Eec50_treatmentretigabine       1991
## Eec50_treatmentztz240           1775
## Ehill_treatmentretigabine       1769
## Ehill_treatmentztz240           2584
## Etop_treatmentretigabine        1704
## Etop_treatmentztz240            3177
## Ebottom_treatmentretigabine     2384
## Ebottom_treatmentztz240         1957
## Hec50_treatmentretigabine         41
## Hec50_treatmentztz240             32
## Hhill_treatmentretigabine       2370
## Hhill_treatmentztz240             30
## Htop_treatmentretigabine          29
## Htop_treatmentztz240              31
## Hbottom_treatmentretigabine     2330
## Hbottom_treatmentztz240           29
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.06      0.00     0.06     0.06 1.02      168     2195
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).
```





```
## Error in brms::loo_compare(model_MuSyC, model_bilevel): object 'model_MuSyC' not found
```

