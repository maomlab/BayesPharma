<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute the Pnear Quality Metric for a RMSD Funnel — Pnear • BayesPharma</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the Pnear Quality Metric for a RMSD Funnel — Pnear"><meta name="description" content="In protein structure prediction a key measure of accuracy is how well does
the predicted energy or score correlate with the distance to a native
conformation. A common distance measure is the all-atom root mean squared
distance (RMSD). A challenge, however, is that we don't expect that far away
from the native conformation, the energy should be discriminating, so we want
to bias the assessment to those near the native conformation. We therefore
The Pnear metric defined in (Bhardwaj, et al., Nature, 2016)
measures the how &quot;funnel-like&quot; a score-vs-rmsd plot is.
Pnear Rosetta Documentation"><meta property="og:description" content="In protein structure prediction a key measure of accuracy is how well does
the predicted energy or score correlate with the distance to a native
conformation. A common distance measure is the all-atom root mean squared
distance (RMSD). A challenge, however, is that we don't expect that far away
from the native conformation, the energy should be discriminating, so we want
to bias the assessment to those near the native conformation. We therefore
The Pnear metric defined in (Bhardwaj, et al., Nature, 2016)
measures the how &quot;funnel-like&quot; a score-vs-rmsd plot is.
Pnear Rosetta Documentation"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesPharma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/apply_MuSyC_KCNQ.html">Apply: MuSyC Model -- KCNQ Conductance</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_KOR.html">Apply: Sigmoid Model -- KOR Antagonists</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_model_Pnear.html">Apply: Sigmoid Model -- Pnear Folding Funnel</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_ChABC_design.html">Apply: tQ Model -- ChABC Design</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_nSMase2_kinetics.html">Apply: tQ Model -- nSMase2 Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/derive_MuSyC_model.html">Derive: MuSyC Model -- Synergy Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/derive_tQ_model.html">Derive: tQ Model -- Enzyme Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/implement_tidymodels.html">Implement: BayesPharma and Tidymodels</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compute the Pnear Quality Metric for a RMSD Funnel</h1>

      <div class="d-none name"><code>Pnear.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>In protein structure prediction a key measure of accuracy is how well does
the predicted energy or score correlate with the distance to a native
conformation. A common distance measure is the all-atom root mean squared
distance (RMSD). A challenge, however, is that we don't expect that far away
from the native conformation, the energy should be discriminating, so we want
to bias the assessment to those near the native conformation. We therefore
The Pnear metric defined in <a href="https://www.nature.com/articles/nature19791" class="external-link">(Bhardwaj, et al., Nature, 2016)</a>
measures the how "funnel-like" a score-vs-rmsd plot is.
<a href="https://github.com/RosettaCommons/main/blob/master/tests/benchmark/util/quality_measures.py#L268%22" class="external-link">Pnear Rosetta Documentation</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Pnear</span><span class="op">(</span><span class="va">score</span>, <span class="va">rmsd</span>, lambda <span class="op">=</span> <span class="fl">1.5</span>, kbt <span class="op">=</span> <span class="fl">0.62</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-score">score<a class="anchor" aria-label="anchor" href="#arg-score"></a></dt>
<dd><p>a vector of scores e.g. Rosetta energies e.g. in the Ref2015.</p></dd>


<dt id="arg-rmsd">rmsd<a class="anchor" aria-label="anchor" href="#arg-rmsd"></a></dt>
<dd><p>root mean squared deviation values for e.g. backbone atoms</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Lambda is a value in Angstroms indicating the breadth of the
Gaussian used to define "native-like-ness". The bigger the value, the more
permissive the calculation is to structures that deviate from native.
Typical values for peptides range from 1.5 to 2.0, and for proteins from
2.0 to perhaps 4.0.</p></dd>


<dt id="arg-kbt">kbt<a class="anchor" aria-label="anchor" href="#arg-kbt"></a></dt>
<dd><p>The value of k_B*T, in energy units, determines how large an
energy gap must be in order for a sequence to be said to favor the
native state. The default value, 0.62, should correspond to physiological
temperature for ref2015 or any other scorefunction with units of kcal/mol.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>give verbose output.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>numeric</code> value.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># subtract off the min-score as is done in the Rosetta Code</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>scores <span class="ot">=</span> scores <span class="sc">-</span> <span class="fu">min</span>(scores)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># write down the equation in more code-like notation</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>Pnear <span class="ot">&lt;-</span> Sum_i[<span class="fu">exp</span>(<span class="sc">-</span>RMSD[i]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>lambda<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>scores[i]<span class="sc">/</span>k_BT)] <span class="sc">/</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>         Sum_i[<span class="fu">exp</span>(<span class="sc">-</span>scores[i]<span class="sc">/</span>k_BT)]</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># combine the terms in the first exponential</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>Pnear <span class="ot">=</span> Sum_i[<span class="fu">exp</span>(<span class="sc">-</span>RMSD[i]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>lambda<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> scores[i]<span class="sc">/</span>k_BT)] <span class="sc">/</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        Sum_i[<span class="fu">exp</span>(<span class="sc">-</span>scores[i]<span class="sc">/</span>k_BT)]</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>let x_i  <span class="ot">=</span> RMSD[i]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>lambda<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> k_BT<span class="sc">/</span>scores[i]</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    beta <span class="ot">=</span> <span class="sc">-</span>scores[i]</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>Pnear <span class="ot">=</span> Sum_i[<span class="fu">exp</span>(<span class="sc">-</span>RMSD[i]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>lambda<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>k_BT<span class="sc">/</span>scores])]</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co"># Use the log-sum-exponential trick</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="fu">log</span>(Pnear) <span class="ot">=</span>   <span class="fu">log_sum_exp</span>(<span class="sc">-</span>RMSD[i]<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>lambda<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> scores[i]<span class="sc">/</span>k_BT)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>             <span class="sc">-</span> <span class="fu">log_sum_exp</span>(<span class="sc">-</span>scores[i]<span class="sc">/</span>k_BT)</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Unlike the Conway discrimination score, the PNear calculation uses no
hard cutoffs. This is advantageous for repeated testing: if the scatter of
points on the RMSD plot changes very slightly from run to run, the PNear
value will only change by a small amount, whereas any metric dependent on
hard cutoffs could change by a large amount if a low-energy point crosses an
RMSD threshold.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Vikram K. Mulligan <a href="mailto:vmulligan@flatironinstitute.org">vmulligan@flatironinstitute.org</a> adapted
from Rosetta.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="fu">Pnear</span><span class="op">(</span>score <span class="op">=</span> <span class="va">score_a</span>, rmsd <span class="op">=</span> <span class="va">rmsd_a</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Madeline Martin, Matthew O’Meara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

