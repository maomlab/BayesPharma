<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Demonstrate the applying a sigmoid model electrophysiology data">
<title>Apply: Sigmoid Model -- KOR Antagonists • BayesPharma</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply: Sigmoid Model -- KOR Antagonists">
<meta property="og:description" content="Demonstrate the applying a sigmoid model electrophysiology data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BayesPharma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/apply_MuSyC_KCNQ.html">Apply: MuSyC Model -- KCNQ Conductance</a>
    <a class="dropdown-item" href="../articles/apply_sigmoid_KOR.html">Apply: Sigmoid Model -- KOR Antagonists</a>
    <a class="dropdown-item" href="../articles/apply_sigmoid_model_Pnear.html">Apply: Sigmoid Model -- Pnear Folding Funnel</a>
    <a class="dropdown-item" href="../articles/apply_tQ_model_ChABC_design.html">Apply: tQ Model -- ChABC Design</a>
    <a class="dropdown-item" href="../articles/apply_tQ_model_nSMase2_kinetics.html">Apply: tQ Model -- nSMase2 Kinetics</a>
    <a class="dropdown-item" href="../articles/derive_MuSyC_model.html">Derive: MuSyC Model -- Synergy Analysis</a>
    <a class="dropdown-item" href="../articles/derive_tQ_model.html">Derive: tQ Model -- Enzyme Kinetics</a>
    <a class="dropdown-item" href="../articles/implement_tidymodels.html">Implement: BayesPharma and Tidymodels</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Apply: Sigmoid Model -- KOR Antagonists</h1>
            <h3 data-toc-skip class="subtitle">Analysis of Four Kappa
Opioid Receptor Antagonists</h3>
            
      
      
      <div class="d-none name"><code>apply_sigmoid_KOR.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="sec-hill">Hill Equation<a class="anchor" aria-label="anchor" href="#sec-hill"></a>
</h3>
<p>In this case study, we are going to reanalyze the dose responses of 4
Kappa Opioid receptor (KOR) antagonists from a study performed by
Margolis et al. (-<span class="citation">@Margolis2020-bm</span>) using
the <code>BayesPharma</code> package. Whole cell electrophysiology in
acute rat midbrain slices was used to evaluate the pharmacological
properties of four novel KOR antagonists: BTRX-335140, BTRX-395750,
PF-04455242, and JNJ-67953964.</p>
<p>Originally, the dose-response analysis was performed using the
<code>drc</code> package in R, which implements the minimization of
negative log likelihood function and reduces to least square estimation
for a continuous response. The data were normalized to % baseline
agonist response, measuring the extent of blockade of agonist response
in the presence of different concentrations of antagonist. These data
were then fit to a 4-parameter log-logistic dose response model, setting
the top (max agonist response) to 100% and estimating the IC50, its
variance, and the bottom (min agonist response).</p>
<div class="section level4">
<h4 id="fitting-the-sigmoid-model">Fitting the sigmoid model<a class="anchor" aria-label="anchor" href="#fitting-the-sigmoid-model"></a>
</h4>
<p>Using the <code>BayesPharma</code> package, we can re-fit the sigmoid
model with a negative slope, and fix the top parameter to
<code>100</code> as the response is normalized to a no-antagonist
baseline.</p>
<p>For the prior, we are going to use a normal distribution because the
response values are continuous. First, we will run the analysis with the
<code>top</code> (max response) parameter prior set to a constant value
of <code>100</code> because <code>top</code> is normalized to
<code>100</code> and is the default broad prior for the
<code>ic50</code>, <code>hill</code>, and <code>bottom</code>
parameters. Broad priors represent unbiased uncertainty and provide an
opportunity for extreme responses.</p>
<p>The level of informativeness of the prior will affect how much
influence the prior has on the model. Here is more <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations" class="external-link">information
on prior choice recommendations.</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_prior</span> <span class="op">&lt;-</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_prior.html">sigmoid_antagonist_prior</a></span><span class="op">(</span>top <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">kor_prior</span></span>
<span><span class="co">##            prior class coef group resp dpar  nlpar   lb   ub source</span></span>
<span><span class="co">##  normal(-6, 2.5)     b                        ic50 &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##    normal(-1, 1)     b                        hill &lt;NA&gt; 0.01   user</span></span>
<span><span class="co">##    constant(100)     b                         top &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##   normal(0, 0.5)     b                      bottom &lt;NA&gt; &lt;NA&gt;   user</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="prior-predictive-checks">Prior predictive checks<a class="anchor" aria-label="anchor" href="#prior-predictive-checks"></a>
</h4>
<p>Following the Bayesian workflow, before fitting the model, it is good
to check the prior predictive distributions to see if they are
compatible with the domain expertise. So, before running the model, we
will verify that the prior distributions cover a plausible range of
values for each parameter. To do this, we want to sample only from the
prior distributions by adding <code>sample_prior = "only"</code> as an
argument to the <code>sigmoid_model</code> function. We will use the
default response distribution of the model
(<code>family = gaussian()</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_sample_prior</span> <span class="op">&lt;-</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_model.html">sigmoid_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">kor_antag</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_id</span>, <span class="va">log_dose</span>, <span class="va">response</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_formula.html">sigmoid_antagonist_formula</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="va">kor_prior</span>,</span>
<span>  init <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_init.html">sigmoid_antagonist_init</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sample_prior <span class="op">=</span> <span class="st">"only"</span><span class="op">)</span></span></code></pre></div>
<p>And then plot of the prior predictive distributions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_sample_prior</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_density_distribution.html">plot_density_distribution</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-prior-density-plot-1.png" alt="KOR antagonists prior distribution" width="100%"><p class="caption">
KOR antagonists prior distribution
</p>
</div>
<p>To sample from the model, we will use the <code>Stan</code> NUTs
Hamiltonian Monte Carlo, and initialize the parameters to the prior
means to help with model convergence, using the default values of
<code>ec50 = -9</code>, <code>hill = -1</code>, <code>top = 100</code>,
<code>bottom = 0</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_model</span> <span class="op">&lt;-</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_model.html">sigmoid_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">kor_antag</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_id</span>, <span class="va">log_dose</span>, <span class="va">response</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_formula.html">sigmoid_antagonist_formula</a></span><span class="op">(</span></span>
<span>    predictors <span class="op">=</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">substance_id</span><span class="op">)</span>, </span>
<span>  prior <span class="op">=</span> <span class="va">kor_prior</span>,</span>
<span>  init <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_init.html">sigmoid_antagonist_init</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="analyzing-model-fit">Analyzing model fit<a class="anchor" aria-label="anchor" href="#analyzing-model-fit"></a>
</h4>
<p>The <code>brms</code> generated model summary shows the formula that
the expected response a is sigmoid function of the <code>log_dose</code>
with four parameters, and a shared Gaussian distribution. Each parameter
is dependent on the <code>substance_id</code>. Since we want to fit a
separate model for each substance, we include a <code>0 +</code> to
indicate that there is no common intercept. The data consists of
<code>73</code> data points and the posterior sampling was done in
<code>4</code> chains each with <code>8000</code> steps with
<code>4000</code> steps of warm-up. The population effects for each
parameter summarize the marginal posterior distributions, as well as the
effective sample size in the bulk and tail. This gives an indication of
the sampling quality, with an ESS of &gt; <code>500</code> samples being
good for this type of model.</p>
<pre><code><span><span class="co">##  Family: gaussian </span></span>
<span><span class="co">##   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">## Formula: response ~ sigmoid(ic50, hill, top, bottom, log_dose) </span></span>
<span><span class="co">##          ic50 ~ 0 + substance_id</span></span>
<span><span class="co">##          hill ~ 0 + substance_id</span></span>
<span><span class="co">##          top ~ 0 + substance_id</span></span>
<span><span class="co">##          bottom ~ 0 + substance_id</span></span>
<span><span class="co">##    Data: data (Number of observations: 73) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 8000; warmup = 4000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 16000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## ic50_substance_idBTRX_335140      -8.84      0.20    -9.21    -8.40 1.00    16238     8649</span></span>
<span><span class="co">## ic50_substance_idBTRX_395750      -8.24      0.43    -8.93    -7.35 1.00    11144     5226</span></span>
<span><span class="co">## ic50_substance_idJNJ              -9.15      0.32    -9.77    -8.49 1.00    18721    11109</span></span>
<span><span class="co">## ic50_substance_idPF               -6.16      1.09    -7.77    -3.37 1.00     7243     5400</span></span>
<span><span class="co">## hill_substance_idBTRX_335140      -1.46      0.60    -2.87    -0.57 1.00    15956     9588</span></span>
<span><span class="co">## hill_substance_idBTRX_395750      -0.90      0.52    -2.26    -0.26 1.00    11295     6558</span></span>
<span><span class="co">## hill_substance_idJNJ              -1.00      0.50    -2.32    -0.41 1.00    16994    12437</span></span>
<span><span class="co">## hill_substance_idPF               -0.31      0.25    -0.92    -0.03 1.00     7705     5527</span></span>
<span><span class="co">## bottom_substance_idBTRX_335140    -0.00      0.49    -0.97     0.95 1.00    20805    11601</span></span>
<span><span class="co">## bottom_substance_idBTRX_395750     0.02      0.51    -0.98     1.00 1.00    22354    12010</span></span>
<span><span class="co">## bottom_substance_idJNJ            -0.00      0.49    -0.98     0.97 1.00    21344    11981</span></span>
<span><span class="co">## bottom_substance_idPF              0.00      0.49    -0.98     0.97 1.00    20946    12246</span></span>
<span><span class="co">## top_substance_idBTRX_335140      100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## top_substance_idBTRX_395750      100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## top_substance_idJNJ              100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## top_substance_idPF               100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sigma    32.18      2.87    27.12    38.37 1.00    16895    10965</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
<p><strong>Traceplot</strong>: The model ran without warning messages,
meaning there were no parameter value problems or MCMC conflicts. The
bulk and tail ESS indicate high resolution and stability. The R-hat for
each parameter equals <code>1.00</code> and the <code>traceplot</code>
shows the chains mixed well, indicating the chains converged.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-traceplot-1.png" alt="plot of chunk kor-model-traceplot" width="100%"><p class="caption">
plot of chunk kor-model-traceplot
</p>
</div>
<p><strong>Compare prior and posterior marginal distributions</strong>:
Displayed below is a plot for the prior and posterior distributions of
the parameters (prior is pink and posterior is teal). This can be useful
for comparing the density distribution of the prior and posterior
produced by the model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_prior_posterior_densities.html">plot_prior_posterior_densities</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">kor_model</span>,</span>
<span>  predictors_col_name <span class="op">=</span> <span class="st">"substance_id"</span>,</span>
<span>  half_max_label <span class="op">=</span> <span class="st">"ic50"</span>,</span>
<span>  title_label<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-prior-posterior-densities-1.png" alt="KOR antagonists model, compare prior and posterior distributions for each substance" width="100%"><p class="caption">
KOR antagonists model, compare prior and posterior distributions for
each substance
</p>
</div>
<p>Displayed below is a plot of the posterior distributions for each
parameter with the confidence intervals and mean. This is a useful
visual of the model results and can highlight the mode and high-density
intervals:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_posterior_density.html">plot_posterior_density</a></span><span class="op">(</span></span>
<span>  <span class="va">kor_model</span>, </span>
<span>  predictors_col_name <span class="op">=</span> <span class="st">"substance_id"</span>, </span>
<span>  half_max_label <span class="op">=</span> <span class="st">"ic50"</span>,</span>
<span>  title_label <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-posterior-densities-1.png" alt="KOR Antagonists, posterior distribution for each substance" width="100%"><p class="caption">
KOR Antagonists, posterior distribution for each substance
</p>
</div>
<p>Displayed below is a plot of a sample of 100 sigmoid dose-response
curves from the posterior distribution (purple) and the median quantile
intervals:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_posterior_draws.html">plot_posterior_draws</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">kor_model</span>,</span>
<span>  title <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-posterior-draws-1.png" alt="KOR antagonists, posterior draws" width="100%"><p class="caption">
KOR antagonists, posterior draws
</p>
</div>
</div>
<div class="section level4">
<h4 id="comparing-alternative-models">Comparing alternative models<a class="anchor" aria-label="anchor" href="#comparing-alternative-models"></a>
</h4>
<p>To test the sensitivity of the analysis to the prior, we can re-fit
the model with a more informative prior:</p>
<pre><code><span><span class="co">##              prior class coef group resp dpar  nlpar   lb   ub source</span></span>
<span><span class="co">##  normal(-8.5, 0.5)     b                        ic50 &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##    normal(-1, 0.5)     b                        hill &lt;NA&gt; 0.01   user</span></span>
<span><span class="co">##      constant(100)     b                         top &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##     normal(10, 15)     b                      bottom &lt;NA&gt; &lt;NA&gt;   user</span></span></code></pre>
<p>Re-fitting the model with the <code>kor_prior2</code> gives:</p>
<pre><code><span><span class="co">##  Family: gaussian </span></span>
<span><span class="co">##   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">## Formula: response ~ sigmoid(ic50, hill, top, bottom, log_dose) </span></span>
<span><span class="co">##          ic50 ~ 0 + substance_id</span></span>
<span><span class="co">##          hill ~ 0 + substance_id</span></span>
<span><span class="co">##          top ~ 0 + substance_id</span></span>
<span><span class="co">##          bottom ~ 0 + substance_id</span></span>
<span><span class="co">##    Data: data (Number of observations: 73) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 8000; warmup = 4000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 16000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                                Estimate Est.Error l-95% CI u-95% CI Rhat</span></span>
<span><span class="co">## ic50_substance_idBTRX_335140      -8.82      0.21    -9.22    -8.38 1.00</span></span>
<span><span class="co">## ic50_substance_idBTRX_395750      -8.58      0.31    -9.17    -7.96 1.00</span></span>
<span><span class="co">## ic50_substance_idJNJ              -8.95      0.31    -9.53    -8.31 1.00</span></span>
<span><span class="co">## ic50_substance_idPF               -8.18      0.44    -9.06    -7.33 1.00</span></span>
<span><span class="co">## hill_substance_idBTRX_335140      -1.19      0.36    -2.00    -0.57 1.00</span></span>
<span><span class="co">## hill_substance_idBTRX_395750      -1.06      0.39    -1.90    -0.42 1.00</span></span>
<span><span class="co">## hill_substance_idJNJ              -0.86      0.34    -1.70    -0.39 1.00</span></span>
<span><span class="co">## hill_substance_idPF               -0.73      0.45    -1.74    -0.08 1.00</span></span>
<span><span class="co">## bottom_substance_idBTRX_335140     1.67     10.32   -19.03    21.74 1.00</span></span>
<span><span class="co">## bottom_substance_idBTRX_395750    15.50     11.24    -7.81    36.58 1.00</span></span>
<span><span class="co">## bottom_substance_idJNJ            -2.82      9.94   -23.63    15.50 1.00</span></span>
<span><span class="co">## bottom_substance_idPF             31.48     11.43     7.42    51.97 1.00</span></span>
<span><span class="co">## top_substance_idBTRX_335140      100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">## top_substance_idBTRX_395750      100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">## top_substance_idJNJ              100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">## top_substance_idPF               100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">##                                Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## ic50_substance_idBTRX_335140      11617    10443</span></span>
<span><span class="co">## ic50_substance_idBTRX_395750      11302    10768</span></span>
<span><span class="co">## ic50_substance_idJNJ              11345    10928</span></span>
<span><span class="co">## ic50_substance_idPF               12546    10945</span></span>
<span><span class="co">## hill_substance_idBTRX_335140      13618     9668</span></span>
<span><span class="co">## hill_substance_idBTRX_395750      12801     9637</span></span>
<span><span class="co">## hill_substance_idJNJ              12200    12108</span></span>
<span><span class="co">## hill_substance_idPF                9609     6137</span></span>
<span><span class="co">## bottom_substance_idBTRX_335140    12150    10842</span></span>
<span><span class="co">## bottom_substance_idBTRX_395750    11673    10173</span></span>
<span><span class="co">## bottom_substance_idJNJ             9911    10098</span></span>
<span><span class="co">## bottom_substance_idPF             10213     9564</span></span>
<span><span class="co">## top_substance_idBTRX_335140          NA       NA</span></span>
<span><span class="co">## top_substance_idBTRX_395750          NA       NA</span></span>
<span><span class="co">## top_substance_idJNJ                  NA       NA</span></span>
<span><span class="co">## top_substance_idPF                   NA       NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sigma    31.87      2.81    26.92    37.98 1.00    13698    10989</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
<p><strong>Comparing the Two Models Using LOO-Comparison</strong>: One
way to evaluate the quality of a model is for each data-point, re-fit
the model with remaining points and evaluate the log probability of the
point in the posterior distribution. Taking the expectation across all
points gives the Expected Log Pointwise predictive Density (ELPD). Since
this is computationally challenging to re-fit the model for each point,
if the model fits the data reasonably well, then the ELPD can be
approximated using the Pareto smoothed importance sampling (PSIS). Using
the LOO package, Pareto k value for each data point is computed that
indicate how well that data point is fit by the model, where
<code>k &lt; 0.5</code> is good, <code>0.5 &lt;= k &lt; 0.7</code> is
OK, and <code>0.7 &lt;= k</code> is bad. Evaluating the model for the
KOR antagonists shows that the model fits the data well.</p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Computed from 16000 by 73 log-likelihood matrix.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##          Estimate   SE</span></span>
<span><span class="co">## elpd_loo   -360.6  6.5</span></span>
<span><span class="co">## p_loo         7.0  1.1</span></span>
<span><span class="co">## looic       721.2 13.0</span></span>
<span><span class="co">## ------</span></span>
<span><span class="co">## MCSE of elpd_loo is 0.0.</span></span>
<span><span class="co">## MCSE and ESS estimates assume MCMC draws (r_eff in [0.3, 1.4]).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All Pareto k estimates are good (k &lt; 0.7).</span></span>
<span><span class="co">## See help('pareto-k-diagnostic') for details.</span></span></code></pre>
<p>Since ELPD is a global measure of model fit, it can be used to
compare models. Using <code>loo_compare</code> from the LOO package
returns the <code>elpd_diff</code> and <code>se_diff</code> for each
model relative the model with the lowest ELPD. The
<code>kor_model2</code>, the model with more informative prior, is the
preferred model, but not significantly.</p>
<pre><code><span><span class="co">## No problematic observations found. Returning the original 'loo' object.</span></span>
<span><span class="co">##            elpd_diff se_diff</span></span>
<span><span class="co">## kor_model2  0.0       0.0   </span></span>
<span><span class="co">## kor_model  -1.1       1.2</span></span></code></pre>
<p><strong>Comparing against models fit with the <code>drc</code>
Package</strong>: Here we will analyze the KOR antagonist data using the
<code>drc</code> package and compare it to the results from the
<code>BayesPharma</code> analysis.</p>
<p>We will fix the top to <code>100</code> and fit the
<code>ic50</code>, <code>hill</code>, and <code>bottom</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drc_models</span> <span class="op">&lt;-</span> <span class="va">kor_antag</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">substance_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html" class="external-link">group_nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu">drc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span></span>
<span>        <span class="va">response</span> <span class="op">~</span> <span class="va">log_dose</span>,</span>
<span>        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>        fct <span class="op">=</span> <span class="fu">drc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/logistic.html" class="external-link">L.4</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">100</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>        names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hill"</span>, <span class="st">"bottom"</span>, <span class="st">"top"</span>, <span class="st">"ic50"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">drc_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>summary <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">substance_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span>, <span class="op">-</span><span class="va">model</span>, <span class="op">-</span><span class="va">curve</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 12 × 8</span></span>
<span><span class="co">##    substance_id term   estimate std.error statistic  p.value  conf.low conf.high</span></span>
<span><span class="co">##    &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 BTRX_335140  bottom     1.31    19.4      0.0675 9.47e- 1  -40.0        42.6 </span></span>
<span><span class="co">##  2 BTRX_395750  bottom    29.5      9.40     3.14   7.85e- 3    9.20       49.8 </span></span>
<span><span class="co">##  3 JNJ          bottom   -18.1     26.7     -0.681  5.04e- 1  -73.7        37.4 </span></span>
<span><span class="co">##  4 PF           bottom    39.4     30.8      1.28   2.22e- 1  -27.0       106.  </span></span>
<span><span class="co">##  5 BTRX_335140  hill       4.06     9.20     0.441  6.65e- 1  -15.5        23.7 </span></span>
<span><span class="co">##  6 BTRX_395750  hill       9.82   164.       0.0600 9.53e- 1 -344.        364.  </span></span>
<span><span class="co">##  7 JNJ          hill       1.17     0.580    2.02   5.69e- 2   -0.0378      2.38</span></span>
<span><span class="co">##  8 PF           hill       1.13     1.33     0.855  4.08e- 1   -1.73        4.00</span></span>
<span><span class="co">##  9 BTRX_335140  ic50      -8.91     0.308  -28.9    1.42e-14   -9.57       -8.26</span></span>
<span><span class="co">## 10 BTRX_395750  ic50      -8.97     0.505  -17.8    1.70e-10  -10.1        -7.88</span></span>
<span><span class="co">## 11 JNJ          ic50      -8.77     0.670  -13.1    2.89e-11  -10.2        -7.37</span></span>
<span><span class="co">## 12 PF           ic50      -7.96     1.27    -6.29   2.78e- 5  -10.7        -5.23</span></span></code></pre></div>
<p>Displayed below is the comparison of results from <code>drc</code>
and <code>BayesPharma</code> for each parameter of the dose-response
curve. Here we see that the Bayesian method provides a distribution
curve as evidence and has smaller confidence intervals than most of the
standard errors provided by the <code>drc</code> method.</p>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-plot-vs-drc-1.png" alt="KOR antagonists conditional effects. The blue lines are samples from the `BayesPharma` kor_model posterior distribution, the orange line is the conditional mean, and the purple line is the conditional mean for the `drc` model fit." width="100%"><p class="caption">
KOR antagonists conditional effects. The blue lines are samples from the
<code>BayesPharma</code> kor_model posterior distribution, the orange
line is the conditional mean, and the purple line is the conditional
mean for the <code>drc</code> model fit.
</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Madeline Martin, Matthew O’Meara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
