<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Apply: Sigmoid Model -- KOR Antagonists • BayesPharma</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply: Sigmoid Model -- KOR Antagonists">
<meta name="description" content="Demonstrate the applying a sigmoid model electrophysiology data">
<meta property="og:description" content="Demonstrate the applying a sigmoid model electrophysiology data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesPharma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/apply_MuSyC_KCNQ.html">Apply: MuSyC Model -- KCNQ Conductance</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_KOR.html">Apply: Sigmoid Model -- KOR Antagonists</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_model_Pnear.html">Apply: Sigmoid Model -- Pnear Folding Funnel</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_ChABC_design.html">Apply: tQ Model -- ChABC Design</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_nSMase2_kinetics.html">Apply: tQ Model -- nSMase2 Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/derive_MuSyC_model.html">Derive: MuSyC Model -- Synergy Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/derive_tQ_model.html">Derive: tQ Model -- Enzyme Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/implement_tidymodels.html">Implement: BayesPharma and Tidymodels</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Apply: Sigmoid Model -- KOR Antagonists</h1>
            <h3 data-toc-skip class="subtitle">Analysis of Four Kappa
Opioid Receptor Antagonists</h3>
            
      

      <div class="d-none name"><code>apply_sigmoid_KOR.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="sec-hill">Hill Equation<a class="anchor" aria-label="anchor" href="#sec-hill"></a>
</h3>
<p>In this case study, we are going to reanalyze the dose responses of 4
Kappa Opioid receptor (KOR) antagonists from a study performed by
Margolis et al. (-<span class="citation">@Margolis2020-bm</span>) using
the <code>BayesPharma</code> package. Whole cell electrophysiology in
acute rat midbrain slices was used to evaluate the pharmacological
properties of four novel KOR antagonists: BTRX-335140, BTRX-395750,
PF-04455242, and JNJ-67953964.</p>
<p>Originally, the dose-response analysis was performed using the
<code>drc</code> package in R, which implements the minimization of
negative log likelihood function and reduces to least square estimation
for a continuous response. The data were normalized to % baseline
agonist response, measuring the extent of blockade of agonist response
in the presence of different concentrations of antagonist. These data
were then fit to a 4-parameter log-logistic dose response model, setting
the top (max agonist response) to 100% and estimating the IC50, its
variance, and the bottom (min agonist response).</p>
<div class="section level4">
<h4 id="fitting-the-sigmoid-model">Fitting the sigmoid model<a class="anchor" aria-label="anchor" href="#fitting-the-sigmoid-model"></a>
</h4>
<p>Using the <code>BayesPharma</code> package, we can re-fit the sigmoid
model with a negative slope, and fix the top parameter to
<code>100</code> as the response is normalized to a no-antagonist
baseline.</p>
<p>For the prior, we are going to use a normal distribution because the
response values are continuous. First, we will run the analysis with the
<code>top</code> (max response) parameter prior set to a constant value
of <code>100</code> because <code>top</code> is normalized to
<code>100</code> and is the default broad prior for the
<code>ic50</code>, <code>hill</code>, and <code>bottom</code>
parameters. Broad priors represent unbiased uncertainty and provide an
opportunity for extreme responses.</p>
<p>The level of informativeness of the prior will affect how much
influence the prior has on the model. Here is more <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations" class="external-link">information
on prior choice recommendations.</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_prior</span> <span class="op">&lt;-</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_prior.html">sigmoid_antagonist_prior</a></span><span class="op">(</span>top <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">kor_prior</span></span>
<span><span class="co">##            prior class coef group resp dpar  nlpar   lb   ub source</span></span>
<span><span class="co">##  normal(-6, 2.5)     b                        ic50 &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##    normal(-1, 1)     b                        hill &lt;NA&gt; 0.01   user</span></span>
<span><span class="co">##    constant(100)     b                         top &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##   normal(0, 0.5)     b                      bottom &lt;NA&gt; &lt;NA&gt;   user</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="prior-predictive-checks">Prior predictive checks<a class="anchor" aria-label="anchor" href="#prior-predictive-checks"></a>
</h4>
<p>Following the Bayesian workflow, before fitting the model, it is good
to check the prior predictive distributions to see if they are
compatible with the domain expertise. So, before running the model, we
will verify that the prior distributions cover a plausible range of
values for each parameter. To do this, we want to sample only from the
prior distributions by adding <code>sample_prior = "only"</code> as an
argument to the <code>sigmoid_model</code> function. We will use the
default response distribution of the model
(<code>family = gaussian()</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_sample_prior</span> <span class="op">&lt;-</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_model.html">sigmoid_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">kor_antag</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_id</span>, <span class="va">log_dose</span>, <span class="va">response</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_formula.html">sigmoid_antagonist_formula</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="va">kor_prior</span>,</span>
<span>  init <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_init.html">sigmoid_antagonist_init</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sample_prior <span class="op">=</span> <span class="st">"only"</span><span class="op">)</span></span></code></pre></div>
<p>And then plot of the prior predictive distributions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_sample_prior</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_density_distribution.html">plot_density_distribution</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-prior-density-plot-1.png" alt="KOR antagonists prior distribution" width="100%"><p class="caption">
KOR antagonists prior distribution
</p>
</div>
<p>To sample from the model, we will use the <code>Stan</code> NUTs
Hamiltonian Monte Carlo, and initialize the parameters to the prior
means to help with model convergence, using the default values of
<code>ec50 = -9</code>, <code>hill = -1</code>, <code>top = 100</code>,
<code>bottom = 0</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_model</span> <span class="op">&lt;-</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_model.html">sigmoid_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">kor_antag</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_id</span>, <span class="va">log_dose</span>, <span class="va">response</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_formula.html">sigmoid_antagonist_formula</a></span><span class="op">(</span></span>
<span>    predictors <span class="op">=</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">substance_id</span><span class="op">)</span>, </span>
<span>  prior <span class="op">=</span> <span class="va">kor_prior</span>,</span>
<span>  init <span class="op">=</span> <span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/sigmoid_antagonist_init.html">sigmoid_antagonist_init</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="analyzing-model-fit">Analyzing model fit<a class="anchor" aria-label="anchor" href="#analyzing-model-fit"></a>
</h4>
<p>The <code>brms</code> generated model summary shows the formula that
the expected response a is sigmoid function of the <code>log_dose</code>
with four parameters, and a shared Gaussian distribution. Each parameter
is dependent on the <code>substance_id</code>. Since we want to fit a
separate model for each substance, we include a <code>0 +</code> to
indicate that there is no common intercept. The data consists of
<code>73</code> data points and the posterior sampling was done in
<code>4</code> chains each with <code>8000</code> steps with
<code>4000</code> steps of warm-up. The population effects for each
parameter summarize the marginal posterior distributions, as well as the
effective sample size in the bulk and tail. This gives an indication of
the sampling quality, with an ESS of &gt; <code>500</code> samples being
good for this type of model.</p>
<pre><code><span><span class="co">##  Family: gaussian </span></span>
<span><span class="co">##   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">## Formula: response ~ sigmoid(ic50, hill, top, bottom, log_dose) </span></span>
<span><span class="co">##          ic50 ~ 0 + substance_id</span></span>
<span><span class="co">##          hill ~ 0 + substance_id</span></span>
<span><span class="co">##          top ~ 0 + substance_id</span></span>
<span><span class="co">##          bottom ~ 0 + substance_id</span></span>
<span><span class="co">##    Data: data (Number of observations: 73) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 8000; warmup = 4000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 16000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## ic50_substance_idBTRX_335140      -8.84      0.20    -9.20    -8.42 1.00    15027     8248</span></span>
<span><span class="co">## ic50_substance_idBTRX_395750      -8.24      0.41    -8.93    -7.36 1.00    11072     5925</span></span>
<span><span class="co">## ic50_substance_idJNJ              -9.15      0.31    -9.77    -8.50 1.00    15946    10770</span></span>
<span><span class="co">## ic50_substance_idPF               -6.14      1.08    -7.69    -3.32 1.00     7646     5332</span></span>
<span><span class="co">## hill_substance_idBTRX_335140      -1.47      0.59    -2.85    -0.57 1.00    14309     9824</span></span>
<span><span class="co">## hill_substance_idBTRX_395750      -0.91      0.52    -2.28    -0.26 1.00    10745     7238</span></span>
<span><span class="co">## hill_substance_idJNJ              -1.01      0.51    -2.38    -0.41 1.00    14567    11520</span></span>
<span><span class="co">## hill_substance_idPF               -0.31      0.24    -0.92    -0.03 1.00     7908     5627</span></span>
<span><span class="co">## bottom_substance_idBTRX_335140    -0.00      0.49    -0.96     0.95 1.00    17746    11293</span></span>
<span><span class="co">## bottom_substance_idBTRX_395750     0.01      0.50    -0.97     0.99 1.00    18472    10902</span></span>
<span><span class="co">## bottom_substance_idJNJ            -0.01      0.49    -0.99     0.96 1.00    17703    11821</span></span>
<span><span class="co">## bottom_substance_idPF              0.01      0.50    -0.97     0.99 1.00    16850    11426</span></span>
<span><span class="co">## top_substance_idBTRX_335140      100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## top_substance_idBTRX_395750      100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## top_substance_idJNJ              100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## top_substance_idPF               100.00      0.00   100.00   100.00   NA       NA       NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sigma    32.17      2.90    27.13    38.38 1.00    14788    11389</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
<p><strong>Traceplot</strong>: The model ran without warning messages,
meaning there were no parameter value problems or MCMC conflicts. The
bulk and tail ESS indicate high resolution and stability. The R-hat for
each parameter equals <code>1.00</code> and the <code>traceplot</code>
shows the chains mixed well, indicating the chains converged.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kor_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-traceplot-1.png" alt="plot of chunk kor-model-traceplot" width="100%"><p class="caption">
plot of chunk kor-model-traceplot
</p>
</div>
<p><strong>Compare prior and posterior marginal distributions</strong>:
Displayed below is a plot for the prior and posterior distributions of
the parameters (prior is pink and posterior is teal). This can be useful
for comparing the density distribution of the prior and posterior
produced by the model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_prior_posterior_densities.html">plot_prior_posterior_densities</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">kor_model</span>,</span>
<span>  title_label <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-prior-posterior-densities-1.png" alt="KOR antagonists model, compare prior and posterior distributions for each substance" width="100%"><p class="caption">
KOR antagonists model, compare prior and posterior distributions for
each substance
</p>
</div>
<p>Displayed below is a plot of the posterior distributions for each
parameter with the confidence intervals and mean. This is a useful
visual of the model results and can highlight the mode and high-density
intervals:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_posterior_density.html">plot_posterior_density</a></span><span class="op">(</span></span>
<span>  <span class="va">kor_model</span>,</span>
<span>  title_label <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">## Error in `dplyr::filter()`:</span></span>
<span><span class="co">## ℹ In argument: `!...`.</span></span>
<span><span class="co">## Caused by error in `.data[[".variable"]]`:</span></span>
<span><span class="co">## ! Column `.variable` not found in `.data`.</span></span></code></pre></div>
<p>Displayed below is a plot of a sample of 100 sigmoid dose-response
curves from the posterior distribution (purple) and the median quantile
intervals:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BayesPharma</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_posterior_draws.html">plot_posterior_draws</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">kor_model</span>,</span>
<span>  title <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-posterior-draws-1.png" alt="KOR antagonists, posterior draws" width="100%"><p class="caption">
KOR antagonists, posterior draws
</p>
</div>
</div>
<div class="section level4">
<h4 id="comparing-alternative-models">Comparing alternative models<a class="anchor" aria-label="anchor" href="#comparing-alternative-models"></a>
</h4>
<p>To test the sensitivity of the analysis to the prior, we can re-fit
the model with a more informative prior:</p>
<pre><code><span><span class="co">##              prior class coef group resp dpar  nlpar   lb   ub source</span></span>
<span><span class="co">##  normal(-8.5, 0.5)     b                        ic50 &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##    normal(-1, 0.5)     b                        hill &lt;NA&gt; 0.01   user</span></span>
<span><span class="co">##      constant(100)     b                         top &lt;NA&gt; &lt;NA&gt;   user</span></span>
<span><span class="co">##     normal(10, 15)     b                      bottom &lt;NA&gt; &lt;NA&gt;   user</span></span></code></pre>
<p>Re-fitting the model with the <code>kor_prior2</code> gives:</p>
<pre><code><span><span class="co">##  Family: gaussian </span></span>
<span><span class="co">##   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">## Formula: response ~ sigmoid(ic50, hill, top, bottom, log_dose) </span></span>
<span><span class="co">##          ic50 ~ 0 + substance_id</span></span>
<span><span class="co">##          hill ~ 0 + substance_id</span></span>
<span><span class="co">##          top ~ 0 + substance_id</span></span>
<span><span class="co">##          bottom ~ 0 + substance_id</span></span>
<span><span class="co">##    Data: data (Number of observations: 73) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 8000; warmup = 4000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 16000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                                Estimate Est.Error l-95% CI u-95% CI Rhat</span></span>
<span><span class="co">## ic50_substance_idBTRX_335140      -8.82      0.21    -9.23    -8.37 1.00</span></span>
<span><span class="co">## ic50_substance_idBTRX_395750      -8.58      0.31    -9.16    -7.94 1.00</span></span>
<span><span class="co">## ic50_substance_idJNJ              -8.95      0.31    -9.53    -8.32 1.00</span></span>
<span><span class="co">## ic50_substance_idPF               -8.18      0.45    -9.09    -7.30 1.00</span></span>
<span><span class="co">## hill_substance_idBTRX_335140      -1.19      0.37    -1.99    -0.57 1.00</span></span>
<span><span class="co">## hill_substance_idBTRX_395750      -1.06      0.39    -1.90    -0.42 1.00</span></span>
<span><span class="co">## hill_substance_idJNJ              -0.85      0.33    -1.65    -0.39 1.00</span></span>
<span><span class="co">## hill_substance_idPF               -0.72      0.45    -1.72    -0.07 1.00</span></span>
<span><span class="co">## bottom_substance_idBTRX_335140     1.71     10.47   -19.21    21.94 1.00</span></span>
<span><span class="co">## bottom_substance_idBTRX_395750    15.44     11.10    -7.30    36.02 1.00</span></span>
<span><span class="co">## bottom_substance_idJNJ            -2.77      9.82   -23.22    15.35 1.00</span></span>
<span><span class="co">## bottom_substance_idPF             31.22     11.59     7.03    52.03 1.00</span></span>
<span><span class="co">## top_substance_idBTRX_335140      100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">## top_substance_idBTRX_395750      100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">## top_substance_idJNJ              100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">## top_substance_idPF               100.00      0.00   100.00   100.00   NA</span></span>
<span><span class="co">##                                Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## ic50_substance_idBTRX_335140      13087    10643</span></span>
<span><span class="co">## ic50_substance_idBTRX_395750      12995    10960</span></span>
<span><span class="co">## ic50_substance_idJNJ              13299    11776</span></span>
<span><span class="co">## ic50_substance_idPF               13156    10947</span></span>
<span><span class="co">## hill_substance_idBTRX_335140      14798     9835</span></span>
<span><span class="co">## hill_substance_idBTRX_395750      13437     9765</span></span>
<span><span class="co">## hill_substance_idJNJ              13283    11670</span></span>
<span><span class="co">## hill_substance_idPF                8776     5539</span></span>
<span><span class="co">## bottom_substance_idBTRX_335140    14068    12061</span></span>
<span><span class="co">## bottom_substance_idBTRX_395750    12671    10835</span></span>
<span><span class="co">## bottom_substance_idJNJ            12510    10615</span></span>
<span><span class="co">## bottom_substance_idPF             10495    10156</span></span>
<span><span class="co">## top_substance_idBTRX_335140          NA       NA</span></span>
<span><span class="co">## top_substance_idBTRX_395750          NA       NA</span></span>
<span><span class="co">## top_substance_idJNJ                  NA       NA</span></span>
<span><span class="co">## top_substance_idPF                   NA       NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sigma    31.86      2.83    26.91    37.99 1.00    14470    11441</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
<p><strong>Comparing the Two Models Using LOO-Comparison</strong>: One
way to evaluate the quality of a model is for each data-point, re-fit
the model with remaining points and evaluate the log probability of the
point in the posterior distribution. Taking the expectation across all
points gives the Expected Log Pointwise predictive Density (ELPD). Since
this is computationally challenging to re-fit the model for each point,
if the model fits the data reasonably well, then the ELPD can be
approximated using the Pareto smoothed importance sampling (PSIS). Using
the LOO package, Pareto k value for each data point is computed that
indicate how well that data point is fit by the model, where
<code>k &lt; 0.5</code> is good, <code>0.5 &lt;= k &lt; 0.7</code> is
OK, and <code>0.7 &lt;= k</code> is bad. Evaluating the model for the
KOR antagonists shows that the model fits the data well.</p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Computed from 16000 by 73 log-likelihood matrix.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##          Estimate   SE</span></span>
<span><span class="co">## elpd_loo   -360.5  6.5</span></span>
<span><span class="co">## p_loo         6.9  1.1</span></span>
<span><span class="co">## looic       721.0 13.1</span></span>
<span><span class="co">## ------</span></span>
<span><span class="co">## MCSE of elpd_loo is 0.0.</span></span>
<span><span class="co">## MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.4]).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All Pareto k estimates are good (k &lt; 0.7).</span></span>
<span><span class="co">## See help('pareto-k-diagnostic') for details.</span></span></code></pre>
<p>Since ELPD is a global measure of model fit, it can be used to
compare models. Using <code>loo_compare</code> from the LOO package
returns the <code>elpd_diff</code> and <code>se_diff</code> for each
model relative the model with the lowest ELPD. The
<code>kor_model2</code>, the model with more informative prior, is the
preferred model, but not significantly.</p>
<pre><code><span><span class="co">## No problematic observations found. Returning the original 'loo' object.</span></span>
<span><span class="co">##            elpd_diff se_diff</span></span>
<span><span class="co">## kor_model2  0.0       0.0   </span></span>
<span><span class="co">## kor_model  -0.9       1.2</span></span></code></pre>
<p><strong>Comparing against models fit with the <code>drc</code>
Package</strong>: Here we will analyze the KOR antagonist data using the
<code>drc</code> package and compare it to the results from the
<code>BayesPharma</code> analysis.</p>
<p>We will fix the top to <code>100</code> and fit the
<code>ic50</code>, <code>hill</code>, and <code>bottom</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drc_models</span> <span class="op">&lt;-</span> <span class="va">kor_antag</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">substance_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html" class="external-link">group_nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu">drc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/drm.html" class="external-link">drm</a></span><span class="op">(</span></span>
<span>        <span class="va">response</span> <span class="op">~</span> <span class="va">log_dose</span>,</span>
<span>        data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>        fct <span class="op">=</span> <span class="fu">drc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/drc/man/logistic.html" class="external-link">L.4</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">100</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>        names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hill"</span>, <span class="st">"bottom"</span>, <span class="st">"top"</span>, <span class="st">"ic50"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">drc_models</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>summary <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">substance_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span>, <span class="op">-</span><span class="va">model</span>, <span class="op">-</span><span class="va">curve</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 12 × 8</span></span>
<span><span class="co">##    substance_id term   estimate std.error statistic  p.value  conf.low conf.high</span></span>
<span><span class="co">##    &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 BTRX_335140  bottom     1.31    19.4      0.0675 9.47e- 1  -40.0        42.6 </span></span>
<span><span class="co">##  2 BTRX_395750  bottom    29.5      9.40     3.14   7.85e- 3    9.20       49.8 </span></span>
<span><span class="co">##  3 JNJ          bottom   -18.1     26.7     -0.681  5.04e- 1  -73.7        37.4 </span></span>
<span><span class="co">##  4 PF           bottom    39.4     30.8      1.28   2.22e- 1  -27.0       106.  </span></span>
<span><span class="co">##  5 BTRX_335140  hill       4.06     9.20     0.441  6.65e- 1  -15.5        23.7 </span></span>
<span><span class="co">##  6 BTRX_395750  hill       9.82   164.       0.0600 9.53e- 1 -344.        364.  </span></span>
<span><span class="co">##  7 JNJ          hill       1.17     0.580    2.02   5.69e- 2   -0.0378      2.38</span></span>
<span><span class="co">##  8 PF           hill       1.13     1.33     0.855  4.08e- 1   -1.73        4.00</span></span>
<span><span class="co">##  9 BTRX_335140  ic50      -8.91     0.308  -28.9    1.42e-14   -9.57       -8.26</span></span>
<span><span class="co">## 10 BTRX_395750  ic50      -8.97     0.505  -17.8    1.70e-10  -10.1        -7.88</span></span>
<span><span class="co">## 11 JNJ          ic50      -8.77     0.670  -13.1    2.89e-11  -10.2        -7.37</span></span>
<span><span class="co">## 12 PF           ic50      -7.96     1.27    -6.29   2.78e- 5  -10.7        -5.23</span></span></code></pre></div>
<p>Displayed below is the comparison of results from <code>drc</code>
and <code>BayesPharma</code> for each parameter of the dose-response
curve. Here we see that the Bayesian method provides a distribution
curve as evidence and has smaller confidence intervals than most of the
standard errors provided by the <code>drc</code> method.</p>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_KOR_files/kor-model-plot-vs-drc-1.png" alt="KOR antagonists conditional effects. The blue lines are samples from the `BayesPharma` kor_model posterior distribution, the orange line is the conditional mean, and the purple line is the conditional mean for the `drc` model fit." width="100%"><p class="caption">
KOR antagonists conditional effects. The blue lines are samples from the
<code>BayesPharma</code> kor_model posterior distribution, the orange
line is the conditional mean, and the purple line is the conditional
mean for the <code>drc</code> model fit.
</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Madeline Martin, Matthew O’Meara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
