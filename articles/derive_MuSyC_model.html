<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Derive: MuSyC Model -- Synergy Analysis • BayesPharma</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive: MuSyC Model -- Synergy Analysis">
<meta name="description" content="Derive the functional form, parameterization, and implementation for the MuSyC synergy model.">
<meta property="og:description" content="Derive the functional form, parameterization, and implementation for the MuSyC synergy model.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesPharma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/apply_MuSyC_KCNQ.html">Apply: MuSyC Model -- KCNQ Conductance</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_KOR.html">Apply: Sigmoid Model -- KOR Antagonists</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_model_Pnear.html">Apply: Sigmoid Model -- Pnear Folding Funnel</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_ChABC_design.html">Apply: tQ Model -- ChABC Design</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_nSMase2_kinetics.html">Apply: tQ Model -- nSMase2 Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/derive_MuSyC_model.html">Derive: MuSyC Model -- Synergy Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/derive_tQ_model.html">Derive: tQ Model -- Enzyme Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/implement_tidymodels.html">Implement: BayesPharma and Tidymodels</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Derive: MuSyC Model -- Synergy Analysis</h1>
            
      

      <div class="d-none name"><code>derive_MuSyC_model.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="sec-MuSyC">MuSyC Epistasis Model<a class="anchor" aria-label="anchor" href="#sec-MuSyC"></a>
</h3>
<p>When two different treatments are made in an assay, their combined
effect may be stronger or weaker than what would be expected with an
additive model, the treatments are said to be epistatic For sigmoidal
dose-response models, one treatment may effect of the other in two
different ways; by either shifting the maximal response (efficacy) or by
shifting the dose needed to cause the response (potency). A range of
statistical models have been proposed that capture different aspects of
synergy, notably Bliss independence<span class="citation">(Bliss
1956)</span> and Loewe additivity<span class="citation">(Loewe
1926)</span> models can be used to test for significant efficacy or
potency interactions, respectively. The <code>SynergyFinder</code> R
package<span class="citation">(Ianevski, Giri, and Aittokallio
2022)</span> and the <code>synergy</code> python package<span class="citation">(Wooten and Albert 2021)</span> can be used to
visualize treatment interactions, compute a range of synergy scores, and
test if the interactions are significant.</p>
<p>Recently Meyer et al.<span class="citation">Wooten et al.
(2021)</span> derived an integrated functional synergistic sigmoidal
dose-response called the Multi-dimensional Synergy of Combinations
(MuSyC) method, which has the Loewe and Bliss models as special cases.
They implemented a Bayesian model-fitting strategy in
<code>Matlab</code>, and a maximum likelihood model-fitting into the
synergy python package. To make the model more accessible to the
pharmacology community, in this section, we briefly review the
<code>MuSyC</code> functional form, describe a Bayesian implementation
in <code>Stan</code>/<code>BRMS</code>, and illustrate using the model
to re-analyze how drugs and voltage may interact to modulate the current
through a potassium channel.</p>
<p><strong>MuSyC Functional Form</strong>: The functional form for the
MuSyC model gives an equation for the response <span class="math inline">$\color{brown}{E_d}$</span> at doses of <span class="math inline">$\color{teal}{d_1}$</span> and <span class="math inline">$\color{teal}{d_2}$</span> of the two treatments and
has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>9</mn><annotation encoding="application/x-tex">9</annotation></semantics></math>
free parameters <span class="math inline">$\theta =
\left({\color{purple}{C_1}}, {\color{purple}{C_2}},
{\color{brown}{E_0}}, {\color{brown}{E_1}}, {\color{brown}{E_2}},
{\color{brown}{E_3}},
{\color{purple}{h_1}}, {\color{purple}{h_2}},
{\color{purple}{\alpha}}\right)$</span></p>
<p><span class="math display">$$\begin{align}
{\color{brown}{E_d}} = \mbox{MuSyC}({\color{teal}{d_1}},
{\color{teal}{d_2}}; \theta) &amp;= \frac{
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}{\color{brown}{E_0}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}{\color{brown}{E_1}}
+
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}{\color{brown}{E_2}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}{\color{purple}{\alpha}}
{\color{brown}{E_3}}
       }{
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}
+
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}{\color{purple}{\alpha}}}
\end{align}$$</span> The parameters <span class="math inline">$\color{brown}{E_0}$</span>, <span class="math inline">$\color{brown}{E_3}$</span>, give response values
for the extreme values for the doses: <span class="math inline">$\mbox{MuSyC}({\color{teal}{0}}, {\color{teal}{0}};
\theta) = \color{brown}{E_0}$</span> and <span class="math inline">$\mbox{MuSyC}({\color{teal}{\infty}},
{\color{teal}{\infty}}; \theta) = \color{brown}{E_3}$</span>. Setting
one of the doses to zero e.g., <span class="math inline">${\color{teal}{d_2}} = 0$</span>, the MuSyC
functional form reduces to a sigmoid function of the other, where <span class="math inline">$\mbox{MuSyC}({\color{teal}{d_1}},
{\color{teal}{0}}; \theta) = Sigmoid({\color{teal}{d_1}}; \phi)$</span>,
where the half maximal activity is <span class="math inline">$\mbox{AC}_{50} = \color{purple}{C_1}$</span> and
the slope at the half maximal activity is <span class="math inline">${\color{purple}{\mbox{hill}}} =
{\color{purple}{h_1}}$</span> and if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">h_1 &gt; 0</annotation></semantics></math>,
then <span class="math inline">${\color{brown}{\mbox{top}}} =
{\color{brown}{E_1}}$</span> and <span class="math inline">${\color{brown}{\mbox{bottom}}} =
{\color{brown}{E_0}}$</span>, otherwise the assignment is reversed. See
Appendix XXX for a derivation.</p>
<p>To interpret these parameters if we set <span class="math inline">$\color{teal}{d_2}=0$</span>, then <span class="math display">$$\begin{align}
\color{brown}{E_d} &amp;= \frac{
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{brown}{E_0}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{brown}{E_1}}
       }{
          {\color{purple}{C_1}}^{\color{purple}{h_1}} +
          {\color{teal}{d_1}}^{\color{purple}{h_1}}}
\end{align}$$</span> which is the Hill equation, which we modeled above
. If we then additionally set <span class="math inline">$\color{teal}{d_1}=0$</span> then <span class="math inline">$\color{brown}{E_d}=\color{brown}{E_0}$</span>, in
the limit as <span class="math inline">${\color{teal}{d_1}}\rightarrow
\infty$</span> then <span class="math inline">${\color{brown}{E_d}}\rightarrow
{\color{brown}{E_1}}$</span>, and if <span class="math inline">${\color{teal}{d_1}}=\color{purple}{C_1}$</span>
then <span class="math inline">${\color{brown}{E_d}} =
({\color{brown}{E_0}} + {\color{brown}{E_2}})/2$</span>, which is the
half maximal response (either the <span class="math inline">$\color{brown}{\mbox{IC}_{50}}$</span> if treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
is an inhibitor or <span class="math inline">$\color{brown}{\mbox{EC}_{50}}$</span> if treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
is agonist). The slope at <span class="math inline">${\color{teal}{d_1}}={\color{purple}{C_1}}$</span>
is <span class="math display">$$\begin{align*}
    \frac{\mathrm{d}\;\color{brown}{E_d}}{\mathrm{d}\color{teal}{d_1}}
        &amp;= {\color{purple}{C_1}}^{v}{\color{brown}{E_0}}
              \frac{\mathrm{d}}{\mathrm{d}\color{teal}{d_1}}
                  \frac{1}{{\color{purple}{C_1}}^{\color{purple}{h_1}} +
{\color{teal}{d_1}}^{\color{purple}{h_1}}} +
           {\color{brown}{E_1}}
              \frac{\mathrm{d}}{\mathrm{d}\color{teal}{d_1}}
                   \frac{{\color{teal}{d_1}}^{h_1}}{{\color{purple}{C_1}}^{\color{purple}{h_1}}
+ {\color{teal}{d_1}}^{\color{purple}{h_1}}}\\
        &amp;= {\color{purple}{C_1}}^{h_1}{\color{brown}{E_0}}
              \frac{                          h_1{\color{teal}{d_1}}^{{\color{purple}{h_1}}-1}}{\left({\color{purple}{C_1}}^{\color{purple}{h_1}}
+ {\color{teal}{d_1}}^{\color{purple}{h_1}}\right)^2} +
            {\color{brown}{E_1}}
               \frac{{\color{purple}{C_1}}^{\color{purple}{h_1}}h_1{\color{teal}{d_1}}^{{\color{purple}{h_1}}-1}}{\left({\color{purple}{C_1}}^{\color{purple}{h_1}}
+ {\color{teal}{d_1}}^{\color{purple}{h_1}}\right)^2}\\
        &amp;= ({\color{brown}{E_0}} + {\color{brown}{E_1}})
\end{align*}$$</span></p>
<p>The evaluation of the functional form for <span class="math inline">${\color{brown}{E_d}}$</span> is numerically
unstable due to the exponentiation. To transform using the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="monospace">𝚕𝚘𝚐-𝚜𝚞𝚖-𝚎𝚡𝚙</mtext><annotation encoding="application/x-tex">\texttt{log-sum-exp}</annotation></semantics></math>
trick, let</p>
<p><span class="math display">$$\begin{align*}
\texttt{numerator\_parts} = [\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}) +
\log({\color{brown}{E_0}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}) +
\log({\color{brown}{E_1}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}}) +
\log({\color{brown}{E_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}}) +
\log({\color{brown}{E_3}}) + \log({\color{purple}{\alpha}}) ]\\
\texttt{denominator\_parts} = [\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}})]\\
\end{align*}$$</span> Then for a vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">x = [x_1, x_2, \dots, x_n]</annotation></semantics></math>,
let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">𝚕𝚘𝚐_𝚜𝚞𝚖_𝚎𝚡𝚙</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mtext mathvariant="normal">log</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mtext mathvariant="normal">exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>…</mi><mo>+</mo><mtext mathvariant="normal">exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\texttt{log\_sum\_exp}(x) = \mbox{log}\left(\mbox{exp}(x_1) + \mbox{exp}(x_2) + \dots + \mbox{exp}(x_n)\right)</annotation></semantics></math>.
Then</p>
<p><span class="math display">$$
    {\color{brown}{E_d}} =
\mbox{exp}\!\left(\texttt{log-sum-exp}(\texttt{numerator\_parts}) -
\texttt{log-sum-exp}(\texttt{denominator\_parts})\right).
$$</span> To implement the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">MuSyC</mtext><annotation encoding="application/x-tex">\mbox{MuSyC}</annotation></semantics></math>
model in Stan we use the following parameterization.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the brms MuSyC formula with given covariates</span></span>
<span><span class="va">synergy_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MuSyC_formula.html">MuSyC_formula</a></span><span class="op">(</span>predictors <span class="op">=</span> <span class="va">covariates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># will generate a formula like this</span></span>
<span><span class="va">synergy_formula_alt</span> <span class="op">&lt;-</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html" class="external-link">brmsformula</a></span><span class="op">(</span></span>
<span>  <span class="co"># The Stan MuSyC function is defined in BayesPharma::MuSyC_stanvar()</span></span>
<span>  <span class="va">response</span> <span class="op">~</span> <span class="fu">MuSyC</span><span class="op">(</span></span>
<span>    <span class="va">logd1</span> <span class="op">-</span> <span class="va">logd1scale</span>,</span>
<span>    <span class="va">logd2</span> <span class="op">-</span> <span class="va">logd2scale</span>,</span>
<span>    <span class="va">logE0</span>,</span>
<span>    <span class="va">logC1</span>, <span class="va">logE1</span>, <span class="va">h1</span>,</span>
<span>    <span class="va">logC2</span>, <span class="va">logE2</span>, <span class="va">h2</span>,</span>
<span>    <span class="va">logE3</span>, <span class="va">logalpha</span><span class="op">)</span>,</span>
<span>  nl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># The free parameters are regressed against the given covariates</span></span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">lf</a></span><span class="op">(</span><span class="va">logE0</span>              <span class="op">~</span> <span class="va">covariates</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">lf</a></span><span class="op">(</span><span class="va">logC1</span> <span class="op">+</span> <span class="va">logE1</span> <span class="op">+</span> <span class="va">h1</span> <span class="op">~</span> <span class="va">covariates</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">lf</a></span><span class="op">(</span><span class="va">logC2</span> <span class="op">+</span> <span class="va">logE2</span> <span class="op">+</span> <span class="va">h2</span> <span class="op">~</span> <span class="va">covariates</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">lf</a></span><span class="op">(</span><span class="va">logE3</span> <span class="op">+</span> <span class="va">logalpha</span>   <span class="op">~</span> <span class="va">covariates</span><span class="op">)</span></span></code></pre></div>
<p>Note that if the <code>logd1scale</code> and <code>logd1scale</code>
values are not provided in the the data, when the model is run, they are
automatically computed as the mean value of the doses and is used to
make the model easier to fit.</p>
<div class="section level4">
<h4 id="musyc-model-bayespharma">MuSyC model BayesPharma<a class="anchor" aria-label="anchor" href="#musyc-model-bayespharma"></a>
</h4>
<p>#’ Drug Synergy #’ MuSyC Drug Synergy model #’ #’ Assume that the
response metric decreases with more effective drugs #’ Let E3 be the
effect at the maximum concentration of both drugs #’ #’ #’ Special
cases: #’ * dose additive model: alpha1 = alpha2 = 0 #’ * loewe: h1 = h2
= 1 #’ * CI: E0 = 1, E1 = E2 = E3 = 0 #’ the drug effect is equated with
percent inhibition #’ * bliss drug independence model: #’ E0 = 1, E1 =
E2 = E3 = 0, alpha1 = alpha2 = 1 #’ <span class="citation">(<strong>param?</strong>)</span> d1 Dose of drug 1 #’
<span class="citation">(<strong>param?</strong>)</span> d2 Dose of drug
2 #’ #’ <span class="citation">(<strong>param?</strong>)</span> E0
effect with no drug treatment #’ #’ # params for drug 1 by it self #’
<span class="citation">(<strong>param?</strong>)</span> s1 drug 1 hill
slope #’ <span class="citation">(<strong>param?</strong>)</span> C1 drug
1 EC50 #’ <span class="citation">(<strong>param?</strong>)</span> E1
drug 1 maximum effect #’ #’ # params for drug 2 by it self #’ <span class="citation">(<strong>param?</strong>)</span> s2 drug 2 hill slope
#’ <span class="citation">(<strong>param?</strong>)</span> C2 drug 2
EC50 #’ <span class="citation">(<strong>param?</strong>)</span> E2 drug
2 maximum effect #’ #’ <span class="citation">(<strong>param?</strong>)</span> beta synergistic
efficacy #’ percent increase in a drug combination’s effect #’ beyond
the most efficacious single drug. #’ #’ beta &gt; 0 =&gt; synergistic
efficacy #’ the effect at the maximum concentration of both drugs (E3)
exceeds the #’ maximum effect of either drug alone (E1 or E2) #’ #’ beta
&lt; 0 =&gt; antagonistic efficacy #’ at least one or both drugs are
more efficacious as #’ single agents than in combination #’ #’ <span class="citation">(<strong>param?</strong>)</span> alpha1 synergistic
potency #’ how the effective dose of drug 1 #’ is altered by the
presence of drug 2 #’ <span class="citation">(<strong>param?</strong>)</span> alpha2 synergistic
potency #’ how the effective dose of drug 2 #’ is altered by the
presence of drug 1 #’ #’ alpha &gt; 1 =&gt; synergistic potency #’ the
EC50 decreases because of the addition of the other drug, #’
corresponding to an increase in potency #’ #’ 0 &lt;= alpha &lt; 1 =&gt;
antagonistic potency #’ the EC50 of the drug increases as a result of
the other drug, #’ corresponding to a decrease in potency #’ #’ alpha1
== alpha2 if detailed balance #’ <span class="citation">(<strong>export?</strong>)</span>
generate_MuSyC_effects &lt;- function( d1, d2, E0, s1, C1, E1, s2, C2,
E2, alpha, E3) { h1 &lt;- MuSyC_si_to_hi(s1, C1, E0, E1) h2 &lt;-
MuSyC_si_to_hi(s2, C2, E0, E2) numerator &lt;- C1^h1 * C2^h2 * E0 +
d1^h1 * C2^h2 * E1 + C1^h1 * d2^h2 * E2 + d1^h1 * d2^h2 * E3 * alpha
denominator &lt;- C1^h1 * C2^h2 + d1^h1 * C2^h2 + C1^h1 * d2^h2 + d1^h1
* d2^h2 * alpha numerator / denominator }</p>
<p>#’ Create a formula for the MuSyC synergy model #’ #’ <span class="citation">(<strong>description?</strong>)</span> setup a
defaulMuSyC synergy model formula to predict #’ the <code>E0</code>,
<code>C1</code>, <code>E1</code>, <code>s1</code>, <code>C2</code>,
<code>E2</code>, <code>s2</code>, <code>log10alpha</code>, and
<code>E3alpha</code> #’ parameters. #’ #’ <span class="citation">(<strong>param?</strong>)</span> predictors Additional
formula objects to specify predictors of #’ non-linear parameters.
i.e. what perturbations/experimental differences #’ should be modeled
separately? (Default: 1) should a random effect be taken #’ into
consideration? i.e. cell number, plate number, etc. #’ <span class="citation">(<strong>return?</strong>)</span> brmsformula #’ #’
<span class="citation">(<strong>examples?</strong>)</span> #‘ #’ #’
<span class="citation">(<strong>export?</strong>)</span> MuSyC_formula
&lt;- function( predictors = 1, …) {</p>
<pre><code><span><span class="va">predictor_eq</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/new_formula.html" class="external-link">new_formula</a></span><span class="op">(</span></span>
<span>  lhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">C1</span> <span class="op">+</span> <span class="va">E1</span> <span class="op">+</span> <span class="va">s1</span> <span class="op">+</span> <span class="va">C2</span> <span class="op">+</span> <span class="va">E2</span> <span class="op">+</span> <span class="va">s2</span> <span class="op">+</span> <span class="va">log10alpha</span> <span class="op">+</span> <span class="va">E3alpha</span><span class="op">)</span>,</span>
<span>  rhs <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">enexpr</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html" class="external-link">brmsformula</a></span><span class="op">(</span></span>
<span>  <span class="va">response</span> <span class="op">~</span> <span class="op">(</span><span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E0</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E1</span> <span class="op">+</span></span>
<span>      <span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E2</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E3alpha</span></span>
<span>    <span class="op">)</span> <span class="op">/</span> <span class="op">(</span></span>
<span>      <span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">+</span></span>
<span>      <span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="va">log10alpha</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">d1</span> <span class="op">~</span> <span class="va">dose1</span> <span class="op">/</span> <span class="va">d1_scale_factor</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">d2</span> <span class="op">~</span> <span class="va">dose2</span> <span class="op">/</span> <span class="va">d2_scale_factor</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">h1</span> <span class="op">~</span> <span class="va">s1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">C1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">E1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">h2</span> <span class="op">~</span> <span class="va">s2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">C2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">E2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">predictors_eq</span>,</span>
<span>  nl <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span><span class="op">)</span></span></code></pre>
<p>}</p>
<p>#’ Fit the MuSyC synergy model by dose #’ #’ <span class="citation">(<strong>param?</strong>)</span> data data.frame of
experimental data #’ with columns: dose1, dose2, n_positive, count,
[<group_vars>] #’ <span class="citation">(<strong>param?</strong>)</span> group_vars quosures
list #’ dplyr::vars(…) columns to over when fitting synergy model #’
<span class="citation">(<strong>param?</strong>)</span> C1_prior prior
distribution for Ed when d1=d1_IC50, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> C2_prior prior
distribution for Ed when d1=0, d2=d2_IC50 #’ <span class="citation">(<strong>param?</strong>)</span> s1_prior prior
distribution for d(Ed)/d(d1) when d1=d1_IC50, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> s2_prior prior
distribution for d(Ed)/d(d2) when d1=0, d2=d2_IC50 #’ <span class="citation">(<strong>param?</strong>)</span> log10alpha_prior prior
distribution for alpha synergy parameter #’ <span class="citation">(<strong>param?</strong>)</span> E0_prior prior
distribution for Ed when d1=0, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> E1_prior prior
distribution for Ed when d1=Inf, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> E2_prior prior
distribution for Ed when d1=0, d2=Inf #’ <span class="citation">(<strong>param?</strong>)</span> E3_alpha_prior prior
distribution for Ed scaled by alpha when d1=Inf, #’ d2=Inf #’ <span class="citation">(<strong>param?</strong>)</span> C1_init initial
sampling distribution for the C1 parameter #’ <span class="citation">(<strong>param?</strong>)</span> C2_init initial
sampling distribution for the C2 parameter #’ <span class="citation">(<strong>param?</strong>)</span> s1_init initial
sampling distribution for the s1 parameter #’ <span class="citation">(<strong>param?</strong>)</span> s2_init initial
sampling distribution for the s2 parameter #’ <span class="citation">(<strong>param?</strong>)</span> log10alpha_init
initial sampling distribution for the alpha parameter #’ <span class="citation">(<strong>param?</strong>)</span> E0_init initial
sampling distribution for the E0 parameter #’ <span class="citation">(<strong>param?</strong>)</span> E1_init initial
sampling distribution for the E1 parameter #’ <span class="citation">(<strong>param?</strong>)</span> E2_init initial
sampling distribution for the E2 parameter #’ <span class="citation">(<strong>param?</strong>)</span> E3_alpha_init initial
sampling distribution for the E3 parameter #’ <span class="citation">(<strong>param?</strong>)</span> combine combine the
grouped models into a single brms model #’ <span class="citation">(<strong>param?</strong>)</span> verbose verbose output
#’ #’ <span class="citation">(<strong>param?</strong>)</span> iter
number of stan NUTS sampling steps #’ <span class="citation">(<strong>param?</strong>)</span> cores number of cores
used for sampling #’ <span class="citation">(<strong>param?</strong>)</span> stan_model_args stan
model arguments #’ <span class="citation">(<strong>param?</strong>)</span> control stan control
arguments #’ #’ The #’ #’ bernoulli_inf(n_positive / count) = #’ Ed ~
MuSyC(d1, d2, C_params, E_params, s_params, alpha) #’ #’ To improve
numeric stability, the d1 and d2 and C1 and C2 variables #’ are scaled
to improve numeric stability: #’ #’ d1 = dose1/max(dose1) #’ d2 =
dose2/max(dose2) #’ drug1_IC50 = C1 * max(dose1) #’ drug2_IC50 = C2 *
max(dose2) #’ #’ Functional form: #’ Ed ~ ( #’ C1^h1 * C2^h2 * E0 + #’
d1^h1 * C2^h2 * E1 + #’ C1^h1 * d2^h2 * E2 + #’ d1^h1 * d2^h2 * E3 *
alpha #’ ) / ( #’ C1^h1 * C2^h2 + #’ d1^h1 * C2^h2 + #’ C1^h1 * d2^h2 +
#’ d1^h1 * d2^h2 * alpha #’ ) #’ #’ #’ #’ #’ #’
############################################## #’ # Proof of the
definitions of the parameters # #’
############################################## #’ #’ Claim: When d1=0
and d2=0 then Ed = E0 #’ Ed = (C1^h1 * C2^h2 * E0) / (C1^h1 * C2^h2) #’
= E0 #’ #’ Claim: When d1=0 and d2 -&gt; Inf then Ed = E2 #’ Ed = (C2^h2
* E0 + d2^h2 * E2) / (C2^h2 + d2^h2) #’ = (d2^h2 * E2) / (d2^h2) #’ = E2
#’ #; Claim: When d1=0 and d2=C2 then Ed = (E0 + E2) / 2 #’ When d1&gt;0
and d2 -&gt; Inf then Ed #’ Ed = (C1^h1 * C2^h2 * E0 + C1^h1 * C2^h2 *
E2) / #’ (C1^h1 * C2^h2 + C1^h1 * C2^h2) #’ = (E0 + E2) / 2 #’ #’<span class="citation">(<strong>export?</strong>)</span> MuSyC_model &lt;-
function( data, group_vars = vars(compound), formula = MuSyC_formula(),
prior = MuSyC_prior(), init = MuSyC_init(), combine = FALSE, verbose =
FALSE, iter = 8000, cores = 4, stan_model_args = list(verbose = FALSE),
control = list( adapt_delta = .99, max_treedepth = 12),
model_evaluation_criteria = c(“loo”, “bayes_R2”), …) {</group_vars></p>
<p>if (is.data.frame(well_scores)) { grouped_data &lt;- well_scores
|&gt; dplyr::group_by(!!!group_vars) |&gt; dplyr::mutate(
d1_scale_factor = max(dose1), d2_scale_factor = max(dose2)) |&gt;
tidyr::nest() |&gt; dplyr::ungroup() }</p>
<p>if (verbose) { cat(“Fitting MuSyC model”) }</p>
<p>model &lt;- brms::brm_multiple( formula = formula, data =
grouped_data$data, family = binomial(“identity”), prior = prior, init =
init, # stanvars = c( # brms::stanvar( # scode = ” real d1_scale_factor
= max(dose1));“, # block =”tdata”, # position = “end”), # brms::stanvar(
# scode = ” real d2_scale_factor = max(dose2));“, # block =”tdata”, #
position = “end”), # brms::stanvar( # scode = ” real drug1_IC50 = b_C1 *
d1_scale_factor);“, # block =”genquant”, # position = “end”), #
brms::stanvar( # scode = ” real drug2_IC50 = b_C2 * d2_scale_factor;“, #
block =”genquant”, # position = “end”)), combine = FALSE, data2 = NULL,
iter = iter, cores = cores, stan_model_args = stan_model_args, control =
control, …)</p>
<p>if (!is.null(model_evaluation_criteria)) { # evaluate fits model
&lt;- model |&gt; purrr::imap(function(model, i) { group_index &lt;-
grouped_data[i, ] |&gt; dplyr::select(-data) group_index_label &lt;-
paste0( names(group_index), “:”, group_index, collapse = “,”)
cat(“Evaluating model fit for”, group_index_label, “…”, sep = ““) model
&lt;- model |&gt; brms::add_criterion( criterion =
model_evaluation_criteria, model_name = paste0(”MuSyC:“,
group_index_label), reloo = TRUE) model }) } grouped_data |&gt;
dplyr::mutate( model = model) }</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bliss1956-hf" class="csl-entry">
Bliss, C I. 1956. <span>“The Calculation of Microbial Assays.”</span>
<em>Bacteriol. Rev.</em> 20 (4): 243–58. <a href="https://doi.org/10.1128/br.20.4.243-258.1956" class="external-link">https://doi.org/10.1128/br.20.4.243-258.1956</a>.
</div>
<div id="ref-Ianevski2022-cb" class="csl-entry">
Ianevski, Aleksandr, Anil K Giri, and Tero Aittokallio. 2022.
<span>“<span>SynergyFinder</span> 3.0: An Interactive Analysis and
Consensus Interpretation of Multi-Drug Synergies Across Multiple
Samples.”</span> <em>Nucleic Acids Research</em>. <a href="https://doi.org/10.1093/nar/gkac382" class="external-link">https://doi.org/10.1093/nar/gkac382</a>.
</div>
<div id="ref-Loewe1926-sr" class="csl-entry">
Loewe, S. 1926. <span>“Effect of Combinations: Mathematical Basis of
Problem.”</span> <em>Arch. Exp. Pathol. Pharmakol.</em> 114: 313–26.
</div>
<div id="ref-Meyer2019-zr" class="csl-entry">
Meyer, Christian T, David J Wooten, B Bishal Paudel, Joshua Bauer,
Keisha N Hardeman, David Westover, Christine M Lovly, Leonard A Harris,
Darren R Tyson, and Vito Quaranta. 2019. <span>“Quantifying Drug
Combination Synergy Along Potency and Efficacy Axes.”</span> <em>Cell
Syst</em> 8 (2): 97–108.e16. <a href="https://doi.org/10.1016/j.cels.2019.01.003" class="external-link">https://doi.org/10.1016/j.cels.2019.01.003</a>.
</div>
<div id="ref-Wooten2021-cr" class="csl-entry">
Wooten, David J, and Réka Albert. 2021. <span>“Synergy: A Python Library
for Calculating, Analyzing and Visualizing Drug Combination
Synergy.”</span> <em>Bioinformatics</em> 37 (10): 1473–74. <a href="https://doi.org/10.1093/bioinformatics/btaa826" class="external-link">https://doi.org/10.1093/bioinformatics/btaa826</a>.
</div>
<div id="ref-Wooten2021-lg" class="csl-entry">
Wooten, David J, Christian T Meyer, Alexander L R Lubbock, Vito
Quaranta, and Carlos F Lopez. 2021. <span>“<span>MuSyC</span> Is a
Consensus Framework That Unifies Multi-Drug Synergy Metrics for
Combinatorial Drug Discovery.”</span> <em>Nat. Commun.</em> 12 (1):
4607. <a href="https://doi.org/10.1038/s41467-021-24789-z" class="external-link">https://doi.org/10.1038/s41467-021-24789-z</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Madeline Martin, Matthew O’Meara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
