<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Derive the functional form, parameterization, and implementation for the MuSyC synergy model.">
<title>Derive: MuSyC Model -- Synergy Analysis • BayesPharma</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive: MuSyC Model -- Synergy Analysis">
<meta property="og:description" content="Derive the functional form, parameterization, and implementation for the MuSyC synergy model.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BayesPharma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/apply_MuSyC_model_KCNQ_conductance.html">Apply: MuSyC Model -- KCNQ Conductance</a>
    <a class="dropdown-item" href="../articles/apply_sigmoid_model_KOR_antagonists.html">Apply: Sigmoid Model -- KOR Antagonists</a>
    <a class="dropdown-item" href="../articles/apply_sigmoid_model_Pnear.html">Apply: Sigmoid Model -- Pnear Folding Funnel</a>
    <a class="dropdown-item" href="../articles/apply_tQ_model_ChABC_design.html">Apply: tQ Model -- ChABC Design</a>
    <a class="dropdown-item" href="../articles/apply_tQ_model_nSMase2_kinetics.html">Apply: tQ Model -- nSMase2 Kinetics</a>
    <a class="dropdown-item" href="../articles/derive_MuSyC_model.html">Derive: MuSyC Model -- Synergy Analysis</a>
    <a class="dropdown-item" href="../articles/derive_tQ_model.html">Derive: tQ Model -- Enzyme Kinetics</a>
    <a class="dropdown-item" href="../articles/implement_tidymodels.html">Implement: BayesPharma and Tidymodels</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Derive: MuSyC Model -- Synergy Analysis</h1>
            
      
      
      <div class="d-none name"><code>derive_MuSyC_model.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="MuSyC">MuSyC synergy model<a class="anchor" aria-label="anchor" href="#MuSyC"></a>
</h2>
<p>When two different treatments are combined they may interact to cause
a response. For end-point assays, if the response is stronger or weaker
than what would be expected with an additive model, the treatments are
said to be epistatic. For sigmoidal dose-response models, however, the
analysis may be more complicated. One drug may not only may shift the
maximal response (efficacy) of the other, but it may also shift the
effective dose and shape of the response (potency). Historically a range
of models have been proposed that capture different aspects of synergy,
for example the Bliss independence and Loewe additivity are null-models
for no synergistic efficacy or potency, respectively. The R package and
the python package can be used to visualize treatment interactions,
compute a range of synergy scores, and test if the interactions are
significant.</p>
<p>Recently Meyer et al. derived an integrated functional synergistic
sigmoidal dose-response, which has the Loewe and Bliss models as special
cases. They implemented a Bayesian model-fitting strategy in Matlab, and
a maximum likelihood model-ftting into the synergy python package. To
make the model more accessible to the pharmacology community, in this
section, we briefly review the MuSyC functional form, describe a
Bayesian implementation in Stan/BRMS, and illustrate using the model to
re-analyze how drugs and voltage may interact to modulate the current
through a potassium channel.</p>
<div class="section level3">
<h3 id="musyc-functional-form">MuSyc Functional Form<a class="anchor" aria-label="anchor" href="#musyc-functional-form"></a>
</h3>
<p>The functional form for the MuSyC model gives an equation for the
response <span class="math inline">\(\color{brown}{E_d}\)</span> at
doses of <span class="math inline">\(\color{teal}{d_1}\)</span> and
<span class="math inline">\(\color{teal}{d_2}\)</span> of the two
treatments and has <span class="math inline">\(9\)</span> free
parameters <span class="math inline">\(\color{purple}{C_1}\)</span>,
<span class="math inline">\(\color{purple}{C_2}\)</span>, <span class="math inline">\(\color{brown}{E_0}\)</span>, <span class="math inline">\(\color{brown}{E_1}\)</span>, <span class="math inline">\(\color{brown}{E_2}\)</span>, <span class="math inline">\(\color{brown}{E_3}\)</span>, <span class="math inline">\(\color{purple}{h_1}\)</span>, <span class="math inline">\(\color{purple}{h_2}\)</span>, <span class="math inline">\(\color{purple}{\alpha}\)</span>:</p>
<p><span class="math display">\[\begin{align}
\color{brown}{E_d} &amp;= \frac{
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}{\color{brown}{E_0}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}{\color{brown}{E_1}}
+
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}{\color{brown}{E_2}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}{\color{purple}{\alpha}}
{\color{brown}{E_3}}
       }{
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{purple}{C_2}}^{\color{purple}{h_2}}
+
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{teal}{d_2}}^{\color{purple}{h_2}}{\color{purple}{\alpha}}}
\end{align}\]</span></p>
<p>To interpret these parameters if we set <span class="math inline">\(\color{teal}{d_2}=0\)</span>, then <span class="math display">\[\begin{align}
\color{brown}{E_d} &amp;= \frac{
          {\color{purple}{C_1}}^{\color{purple}{h_1}}{\color{brown}{E_0}}
+
          {\color{teal}{d_1}}^{\color{purple}{h_1}}{\color{brown}{E_1}}
       }{
          {\color{purple}{C_1}}^{\color{purple}{h_1}} +
          {\color{teal}{d_1}}^{\color{purple}{h_1}}}
\end{align}\]</span> which is the Hill equation, which we modeled above
<span class="math inline">\(\ref{sec:hill}\)</span>. If we then
additionally set <span class="math inline">\(\color{teal}{d_1}=0\)</span> then <span class="math inline">\(\color{brown}{E_d}=\color{brown}{E_0}\)</span>, in
the limit as <span class="math inline">\({\color{teal}{d_1}}\rightarrow
\infty\)</span> then <span class="math inline">\({\color{brown}{E_d}}\rightarrow
{\color{brown}{E_1}}\)</span>, and if <span class="math inline">\({\color{teal}{d_1}}=\color{purple}{C_1}\)</span>
then <span class="math inline">\({\color{brown}{E_d}} =
({\color{brown}{E_0}} + {\color{brown}{E_2}})/2\)</span>, which is the
half maximal response (either the <span class="math inline">\(\color{brown}{\mbox{IC}_{50}}\)</span> if
treatment <span class="math inline">\(1\)</span> is an inhibitor or
<span class="math inline">\(\color{brown}{\mbox{EC}_{50}}\)</span> if
treatment <span class="math inline">\(1\)</span> is agonist). The slope
at <span class="math inline">\({\color{teal}{d_1}}={\color{purple}{C_1}}\)</span>
is <span class="math display">\[\begin{align*}
    \frac{\mathrm{d}\;\color{brown}{E_d}}{\mathrm{d}\color{teal}{d_1}}
        &amp;= {\color{purple}{C_1}}^{v}{\color{brown}{E_0}}
              \frac{\mathrm{d}}{\mathrm{d}\color{teal}{d_1}}
                  \frac{1}{{\color{purple}{C_1}}^{\color{purple}{h_1}} +
{\color{teal}{d_1}}^{\color{purple}{h_1}}} +
           {\color{brown}{E_1}}
              \frac{\mathrm{d}}{\mathrm{d}\color{teal}{d_1}}
                   \frac{{\color{teal}{d_1}}^{h_1}}{{\color{purple}{C_1}}^{\color{purple}{h_1}}
+ {\color{teal}{d_1}}^{\color{purple}{h_1}}}\\
        &amp;= {\color{purple}{C_1}}^{h_1}{\color{brown}{E_0}}
              \frac{                          h_1{\color{teal}{d_1}}^{{\color{purple}{h_1}}-1}}{\left({\color{purple}{C_1}}^{\color{purple}{h_1}}
+ {\color{teal}{d_1}}^{\color{purple}{h_1}}\right)^2} +
            {\color{brown}{E_1}}
               \frac{{\color{purple}{C_1}}^{\color{purple}{h_1}}h_1{\color{teal}{d_1}}^{{\color{purple}{h_1}}-1}}{\left({\color{purple}{C_1}}^{\color{purple}{h_1}}
+ {\color{teal}{d_1}}^{\color{purple}{h_1}}\right)^2}\\
        &amp;= ({\color{brown}{E_0}} + {\color{brown}{E_1}})
\end{align*}\]</span></p>
<p>The evaluation of the functional form for <span class="math inline">\({\color{brown}{E_d}}\)</span> is numerically
unstable. To transform using the <span class="math inline">\(\mbox{log\_sum\_exp}\)</span> trick, let</p>
<p><span class="math display">\[\begin{align*}
\mbox{numerator\_parts} = [\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}) +
\log({\color{brown}{E_0}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}) +
\log({\color{brown}{E_1}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}}) +
\log({\color{brown}{E_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}}) +
\log({\color{brown}{E_3}}) + \log({\color{purple}{\alpha}}) ]\\
\mbox{denominator\_parts} = [\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{purple}{C_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{purple}{C_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}}),\\
      &amp;{\color{purple}{h_1}}\log({\color{teal}{d_1}}) +
{\color{purple}{h_2}}\log({\color{teal}{d_2}})]\\
\end{align*}\]</span> Then <span class="math display">\[
    E_d =
\mbox{exp}\!\left(\mbox{log\_sum\_exp}(\mbox{numerator\_parts}) -
\mbox{log\_sum\_exp}(\mbox{denominator\_parts})\right).
\]</span></p>
</div>
<div class="section level3">
<h3 id="implementation-and-usage-of-the-musyc-model-in-stanbrms">Implementation and usage of the MuSyC model in Stan/BRMS<a class="anchor" aria-label="anchor" href="#implementation-and-usage-of-the-musyc-model-in-stanbrms"></a>
</h3>
<p>#’ Drug Synergy #’ MuSyC Drug Synergy model #’ #’ Assume that the
response metric decreases with more effective drugs #’ Let E3 be the
effect at the maximum concentration of both drugs #’ #’ #’ Special
cases: #’ * dose additive model: alpha1 = alpha2 = 0 #’ * loewe: h1 = h2
= 1 #’ * CI: E0 = 1, E1 = E2 = E3 = 0 #’ the drug effect is equated with
percent inhibition #’ * bliss drug independence model: #’ E0 = 1, E1 =
E2 = E3 = 0, alpha1 = alpha2 = 1 #’ <span class="citation">(<strong>param?</strong>)</span> d1 Dose of drug 1 #’
<span class="citation">(<strong>param?</strong>)</span> d2 Dose of drug
2 #’ #’ <span class="citation">(<strong>param?</strong>)</span> E0
effect with no drug treatment #’ #’ # params for drug 1 by it self #’
<span class="citation">(<strong>param?</strong>)</span> s1 drug 1 hill
slope #’ <span class="citation">(<strong>param?</strong>)</span> C1 drug
1 EC50 #’ <span class="citation">(<strong>param?</strong>)</span> E1
drug 1 maximum effect #’ #’ # params for drug 2 by it self #’ <span class="citation">(<strong>param?</strong>)</span> s2 drug 2 hill slope
#’ <span class="citation">(<strong>param?</strong>)</span> C2 drug 2
EC50 #’ <span class="citation">(<strong>param?</strong>)</span> E2 drug
2 maximum effect #’ #’ <span class="citation">(<strong>param?</strong>)</span> beta synergistic
efficacy #’ percent increase in a drug combination’s effect #’ beyond
the most efficacious single drug. #’ #’ beta &gt; 0 =&gt; synergistic
efficacy #’ the effect at the maximum concentration of both drugs (E3)
exceeds the #’ maximum effect of either drug alone (E1 or E2) #’ #’ beta
&lt; 0 =&gt; antagonistic efficacy #’ at least one or both drugs are
more efficacious as #’ single agents than in combination #’ #’ <span class="citation">(<strong>param?</strong>)</span> alpha1 synergistic
potency #’ how the effective dose of drug 1 #’ is altered by the
presence of drug 2 #’ <span class="citation">(<strong>param?</strong>)</span> alpha2 synergistic
potency #’ how the effective dose of drug 2 #’ is altered by the
presence of drug 1 #’ #’ alpha &gt; 1 =&gt; synergistic potency #’ the
EC50 decreases because of the addition of the other drug, #’
corresponding to an increase in potency #’ #’ 0 &lt;= alpha &lt; 1 =&gt;
antagonistic potency #’ the EC50 of the drug increases as a result of
the other drug, #’ corresponding to a decrease in potency #’ #’ alpha1
== alpha2 if detailed balance #’ <span class="citation">(<strong>export?</strong>)</span>
generate_MuSyC_effects &lt;- function( d1, d2, E0, s1, C1, E1, s2, C2,
E2, alpha, E3) { h1 &lt;- MuSyC_si_to_hi(s1, C1, E0, E1) h2 &lt;-
MuSyC_si_to_hi(s2, C2, E0, E2) numerator &lt;- C1^h1 * C2^h2 * E0 +
d1^h1 * C2^h2 * E1 + C1^h1 * d2^h2 * E2 + d1^h1 * d2^h2 * E3 * alpha
denominator &lt;- C1^h1 * C2^h2 + d1^h1 * C2^h2 + C1^h1 * d2^h2 + d1^h1
* d2^h2 * alpha numerator / denominator }</p>
<p>#’ Create a formula for the MuSyC synergy model #’ #’ <span class="citation">(<strong>description?</strong>)</span> setup a
defaulMuSyC synergy model formula to predict #’ the <code>E0</code>,
<code>C1</code>, <code>E1</code>, <code>s1</code>, <code>C2</code>,
<code>E2</code>, <code>s2</code>, <code>log10alpha</code>, and
<code>E3alpha</code> #’ parameters. #’ #’ <span class="citation">(<strong>param?</strong>)</span> predictors Additional
formula objects to specify predictors of #’ non-linear parameters.
i.e. what perturbations/experimental differences #’ should be modeled
separately? (Default: 1) should a random effect be taken #’ into
consideration? i.e. cell number, plate number, etc. #’ <span class="citation">(<strong>return?</strong>)</span> brmsformula #’ #’
<span class="citation">(<strong>examples?</strong>)</span> #‘ #’ #’
<span class="citation">(<strong>export?</strong>)</span> MuSyC_formula
&lt;- function( predictors = 1, …) {</p>
<pre><code><span><span class="va">predictor_eq</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/new_formula.html" class="external-link">new_formula</a></span><span class="op">(</span></span>
<span>  lhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">C1</span> <span class="op">+</span> <span class="va">E1</span> <span class="op">+</span> <span class="va">s1</span> <span class="op">+</span> <span class="va">C2</span> <span class="op">+</span> <span class="va">E2</span> <span class="op">+</span> <span class="va">s2</span> <span class="op">+</span> <span class="va">log10alpha</span> <span class="op">+</span> <span class="va">E3alpha</span><span class="op">)</span>,</span>
<span>  rhs <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">enexpr</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html" class="external-link">brmsformula</a></span><span class="op">(</span></span>
<span>  <span class="va">response</span> <span class="op">~</span> <span class="op">(</span><span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E0</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E1</span> <span class="op">+</span></span>
<span>      <span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E2</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="va">E3alpha</span></span>
<span>    <span class="op">)</span> <span class="op">/</span> <span class="op">(</span></span>
<span>      <span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">C2</span><span class="op">^</span><span class="va">h2</span> <span class="op">+</span></span>
<span>      <span class="va">C1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">+</span></span>
<span>      <span class="va">d1</span><span class="op">^</span><span class="va">h1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">^</span><span class="va">h2</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="va">log10alpha</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">d1</span> <span class="op">~</span> <span class="va">dose1</span> <span class="op">/</span> <span class="va">d1_scale_factor</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">d2</span> <span class="op">~</span> <span class="va">dose2</span> <span class="op">/</span> <span class="va">d2_scale_factor</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">h1</span> <span class="op">~</span> <span class="va">s1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">C1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">E1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula-helpers.html" class="external-link">nlf</a></span><span class="op">(</span><span class="va">h2</span> <span class="op">~</span> <span class="va">s2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">C2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">E0</span> <span class="op">+</span> <span class="va">E2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">predictors_eq</span>,</span>
<span>  nl <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span><span class="op">)</span></span></code></pre>
<p>}</p>
<p>#’ Fit the MuSyC synergy model by dose #’ #’ <span class="citation">(<strong>param?</strong>)</span> data data.frame of
experimental data #’ with columns: dose1, dose2, n_positive, count,
[<group_vars>] #’ <span class="citation">(<strong>param?</strong>)</span> group_vars quosures
list #’ dplyr::vars(…) columns to over when fitting synergy model #’
<span class="citation">(<strong>param?</strong>)</span> C1_prior prior
distribution for Ed when d1=d1_IC50, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> C2_prior prior
distribution for Ed when d1=0, d2=d2_IC50 #’ <span class="citation">(<strong>param?</strong>)</span> s1_prior prior
distribution for d(Ed)/d(d1) when d1=d1_IC50, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> s2_prior prior
distribution for d(Ed)/d(d2) when d1=0, d2=d2_IC50 #’ <span class="citation">(<strong>param?</strong>)</span> log10alpha_prior prior
distribution for alpha synergy parameter #’ <span class="citation">(<strong>param?</strong>)</span> E0_prior prior
distribution for Ed when d1=0, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> E1_prior prior
distribution for Ed when d1=Inf, d2=0 #’ <span class="citation">(<strong>param?</strong>)</span> E2_prior prior
distribution for Ed when d1=0, d2=Inf #’ <span class="citation">(<strong>param?</strong>)</span> E3_alpha_prior prior
distribution for Ed scaled by alpha when d1=Inf, #’ d2=Inf #’ <span class="citation">(<strong>param?</strong>)</span> C1_init initial
sampling distribution for the C1 parameter #’ <span class="citation">(<strong>param?</strong>)</span> C2_init initial
sampling distribution for the C2 parameter #’ <span class="citation">(<strong>param?</strong>)</span> s1_init initial
sampling distribution for the s1 parameter #’ <span class="citation">(<strong>param?</strong>)</span> s2_init initial
sampling distribution for the s2 parameter #’ <span class="citation">(<strong>param?</strong>)</span> log10alpha_init intial
sampling distribution for the alpha parameter #’ <span class="citation">(<strong>param?</strong>)</span> E0_init initial
sampling distribution for the E0 parameter #’ <span class="citation">(<strong>param?</strong>)</span> E1_init initial
sampling distribution for the E1 parameter #’ <span class="citation">(<strong>param?</strong>)</span> E2_init initial
sampling distribution for the E2 parameter #’ <span class="citation">(<strong>param?</strong>)</span> E3_alpha_init initial
sampling distribution for the E3 parameter #’ <span class="citation">(<strong>param?</strong>)</span> combine combine the
grouped models into a single brms model #’ <span class="citation">(<strong>param?</strong>)</span> verbose verbose output
#’ #’ <span class="citation">(<strong>param?</strong>)</span> iter
number of stan NUTS sampling steps #’ <span class="citation">(<strong>param?</strong>)</span> cores number of cores
used for sampling #’ <span class="citation">(<strong>param?</strong>)</span> stan_model_args stan
model arguments #’ <span class="citation">(<strong>param?</strong>)</span> control stan control
arguments #’ #’ The #’ #’ bernoulli_inf(n_positive / count) = #’ Ed ~
MuSyC(d1, d2, C_params, E_params, s_params, alpha) #’ #’ To improve
numeric stability, the d1 and d2 and C1 and C2 variables #’ are scaled
to improve numeric stability: #’ #’ d1 = dose1/max(dose1) #’ d2 =
dose2/max(dose2) #’ drug1_IC50 = C1 * max(dose1) #’ drug2_IC50 = C2 *
max(dose2) #’ #’ Functional form: #’ Ed ~ ( #’ C1^h1 * C2^h2 * E0 + #’
d1^h1 * C2^h2 * E1 + #’ C1^h1 * d2^h2 * E2 + #’ d1^h1 * d2^h2 * E3 *
alpha #’ ) / ( #’ C1^h1 * C2^h2 + #’ d1^h1 * C2^h2 + #’ C1^h1 * d2^h2 +
#’ d1^h1 * d2^h2 * alpha #’ ) #’ #’ #’ #’ #’ #’
############################################## #’ # Proof of the
definitions of the parameters # #’
############################################## #’ #’ Claim: When d1=0
and d2=0 then Ed = E0 #’ Ed = (C1^h1 * C2^h2 * E0) / (C1^h1 * C2^h2) #’
= E0 #’ #’ Claim: When d1=0 and d2 -&gt; Inf then Ed = E2 #’ Ed = (C2^h2
* E0 + d2^h2 * E2) / (C2^h2 + d2^h2) #’ = (d2^h2 * E2) / (d2^h2) #’ = E2
#’ #; Claim: When d1=0 and d2=C2 then Ed = (E0 + E2) / 2 #’ When d1&gt;0
and d2 -&gt; Inf then Ed #’ Ed = (C1^h1 * C2^h2 * E0 + C1^h1 * C2^h2 *
E2) / #’ (C1^h1 * C2^h2 + C1^h1 * C2^h2) #’ = (E0 + E2) / 2 #’ #’<span class="citation">(<strong>export?</strong>)</span> MuSyC_model &lt;-
function( data, group_vars = vars(compound), formula = MuSyC_formula(),
prior = MuSyC_prior(), init = MuSyC_init(), combine = FALSE, verbose =
FALSE, iter = 8000, cores = 4, stan_model_args = list(verbose = FALSE),
control = list( adapt_delta = .99, max_treedepth = 12),
model_evaluation_criteria = c(“loo”, “bayes_R2”), …) {</group_vars></p>
<p>if (is.data.frame(well_scores)) { grouped_data &lt;- well_scores
|&gt; dplyr::group_by(!!!group_vars) |&gt; dplyr::mutate(
d1_scale_factor = max(dose1), d2_scale_factor = max(dose2)) |&gt;
tidyr::nest() |&gt; dplyr::ungroup() }</p>
<p>if (verbose) { cat(“Fitting MuSyC model”) }</p>
<p>model &lt;- brms::brm_multiple( formula = formula, data =
grouped_data$data, family = binomial(“identity”), prior = prior, init =
init, # stanvars = c( # brms::stanvar( # scode = ” real d1_scale_factor
= max(dose1));“, # block =”tdata”, # position = “end”), # brms::stanvar(
# scode = ” real d2_scale_factor = max(dose2));“, # block =”tdata”, #
position = “end”), # brms::stanvar( # scode = ” real drug1_IC50 = b_C1 *
d1_scale_factor);“, # block =”genquant”, # position = “end”), #
brms::stanvar( # scode = ” real drug2_IC50 = b_C2 * d2_scale_factor;“, #
block =”genquant”, # position = “end”)), combine = FALSE, data2 = NULL,
iter = iter, cores = cores, stan_model_args = stan_model_args, control =
control, …)</p>
<p>if (!is.null(model_evaluation_criteria)) { # evalate fits model &lt;-
model |&gt; purrr::imap(function(model, i) { group_index &lt;-
grouped_data[i, ] |&gt; dplyr::select(-data) group_index_label &lt;-
paste0( names(group_index), “:”, group_index, collapse = “,”)
cat(“Evaluating model fit for”, group_index_label, “…”, sep = ““) model
&lt;- model |&gt; brms::add_criterion( criterion =
model_evaluation_criteria, model_name = paste0(”MuSyC:“,
group_index_label), reloo = TRUE) model }) } grouped_data |&gt;
dplyr::mutate( model = model) }</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Madeline Martin, Matthew O’Meara.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
