<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Apply: Sigmoid Model -- Pnear Folding Funnel • BayesPharma</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply: Sigmoid Model -- Pnear Folding Funnel">
<meta name="description" content="Demonstrate the the sigmoid model to model two-state folding dynamics in molecular simulation of antibodies and compare with the Pnear folding funnel score.">
<meta property="og:description" content="Demonstrate the the sigmoid model to model two-state folding dynamics in molecular simulation of antibodies and compare with the Pnear folding funnel score.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BayesPharma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/apply_MuSyC_KCNQ.html">Apply: MuSyC Model -- KCNQ Conductance</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_KOR.html">Apply: Sigmoid Model -- KOR Antagonists</a></li>
    <li><a class="dropdown-item" href="../articles/apply_sigmoid_model_Pnear.html">Apply: Sigmoid Model -- Pnear Folding Funnel</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_ChABC_design.html">Apply: tQ Model -- ChABC Design</a></li>
    <li><a class="dropdown-item" href="../articles/apply_tQ_model_nSMase2_kinetics.html">Apply: tQ Model -- nSMase2 Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/derive_MuSyC_model.html">Derive: MuSyC Model -- Synergy Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/derive_tQ_model.html">Derive: tQ Model -- Enzyme Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/implement_tidymodels.html">Implement: BayesPharma and Tidymodels</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Apply: Sigmoid Model -- Pnear Folding Funnel</h1>
            
      

      <div class="d-none name"><code>apply_sigmoid_model_Pnear.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="modeling-folding-funnels">Modeling Folding Funnels<a class="anchor" aria-label="anchor" href="#modeling-folding-funnels"></a>
</h2>
<p>A common task in molecular modeling is to predict the conformation of
the folded state for a given molecular system. For example, the Rosetta
<em>ab initio</em>, or protein-protein-interface docking protocols. To
turn the simulation into a prediction requires predicting the relative
free energy of the folded state relative a reference.</p>
<p>The Rosetta score function can score individual conformations, but
doesn’t capture the free energy of the state. Typically, a researcher
will run a series of trajectories and generate a <strong>score vs. RMSD
plot</strong> and look for a “folding funnel” e.g. lower energies for
conformations that are closer to a target folded state. Here, RMSD is
the root-mean squared deviation measuring the euclidean distance of
pairs of atom defined by the application (for example just the backbone
for sequence design or interface atoms for docking).</p>
<div class="section level3">
<h3 id="pnear-score">Pnear score<a class="anchor" aria-label="anchor" href="#pnear-score"></a>
</h3>
<p>To quantify the quality of the folding funnel, recently, there has
been interest in using the <strong>Pnear score</strong>, which is
defined by</p>
<pre><code><span><span class="va">Pnear</span> <span class="op">=</span> <span class="va">Sum_i</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">RMSD</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">lambda</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">score</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">k_BT</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span></span>
<span>        <span class="va">Sum_i</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">score</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">k_BT</span><span class="op">)</span><span class="op">]</span></span></code></pre>
<p>where <em>(RMSD[i], score[i])</em> is the score RMSD and score values
for a conformation <em>i</em>. The parameter <em>lambda</em> is measured
in Angstroms indicating the breadth of the Gaussian used to define
“native-like-ness”. The bigger the value, the more permissive the
calculation is to structures that deviate from native. Typical values
for peptides range from 1.5 to 2.0, and for proteins from 2.0 to perhaps
4.0. And finally the parameter <em>k_BT</em> is measured in in energy
units, determines how large an energy gap must be in order for a
sequence to be said to favor the native state. The default value, 0.62,
should correspond to physiological temperature for ref2015 or any other
scorefunction with units of kcal/mol.</p>
</div>
<div class="section level3">
<h3 id="two-state-model">Two state model<a class="anchor" aria-label="anchor" href="#two-state-model"></a>
</h3>
<p>Thinking of the folded and unfolded states as a two-state model and
RSMD as a reaction coordinate or “collective variable”, then the energy
gap can be modeled by a sigmoidal Boltzmann distribution.</p>
<pre><code><span><span class="co">## Warning in xkcd::theme_xkcd(): Not xkcd fonts installed! See</span></span>
<span><span class="co">## vignette("xkcd-intro")</span></span></code></pre>
<pre><code><span><span class="co">## Warning in theme_xkcd(): Not xkcd fonts installed! See vignette("xkcd-intro")</span></span></code></pre>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_model_Pnear_files/sigmoidal-cartoon-1.png" alt="plot of chunk sigmoidal-cartoon" width="100%"><p class="caption">
plot of chunk sigmoidal-cartoon
</p>
</div>
<p>For a principled molecular dynamics or Monte Carlo simulation that
maintains detailed balance, it is in theory possible to use
thermodynamic integration to quantify the energy gap between the two
states. However, this is often not computationally feasible for proteins
of moderate size or in a protein design or screening context where many
different molecules need to be evaluated given a limited computational
budget. So, Instead, we will assume that the at least locally around the
folded state, the degrees of freedom increase exponentially so that the
log of the RMSD defines a linear reaction coordinate.</p>
<p>If we simulate, trajectory points from the sigmoid on the log(RMSD)
scale, with a Normally distributed error we can generate synthetic
score-vs-rmsd plots</p>
<pre><code><span><span class="co">## Warning in GeomIndicator::geom_indicator(mapping = ggplot2::aes(indicator = paste0("Pnear: ", : All aesthetics have length 1, but the data has 300 rows.</span></span>
<span><span class="co">## ℹ Please consider using `annotate()` or provide this layer with data containing a single row.</span></span></code></pre>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_model_Pnear_files/simulate-score-vs-rmsd-data-1.png" alt="plot of chunk simulate-score-vs-rmsd-data" width="100%"><p class="caption">
plot of chunk simulate-score-vs-rmsd-data
</p>
</div>
<p>A nice thing about having the parametric model to generate
score-vs-rmsd plots, is that it allows us to measure measure the
sensitivity of the Pnear to differently shaped score-vs-rmsd plots. For
example we can scan both the radius of</p>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_model_Pnear_files/simulate-data-scan-1.png" alt="plot of chunk simulate-data-scan" width="100%"><p class="caption">
plot of chunk simulate-data-scan
</p>
</div>
<p>Another question we can use this model to investigate is how
reproducible is the Pnear score?</p>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_model_Pnear_files/simulated-replicates-1.png" alt="plot of chunk simulated-replicates" width="100%"><p class="caption">
plot of chunk simulated-replicates
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="antibody-snugdock-case-study">Antibody SnugDock Case study<a class="anchor" aria-label="anchor" href="#antibody-snugdock-case-study"></a>
</h2>
<p>As a case study, we can look at the real score-vs-rmsd plots from the
Antibody SnugDock scientific benchmark. It is evaluates the SnugDock
protocol over 6 Antibody protein targets</p>
<p>We can use the fit the sigmoid model to the <code>log(RMSD)</code>
using the <code>BayesPharma</code> package, which relies on
<code>BRMS</code> and <code>Stan</code></p>
<p>Check the model parameter fit and estimated parameters:</p>
<pre><code><span><span class="co">##  Family: gaussian </span></span>
<span><span class="co">##   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">## Formula: response ~ sigmoid(ec50, hill, top, bottom, log_dose) </span></span>
<span><span class="co">##          ec50 ~ 0 + target</span></span>
<span><span class="co">##          hill ~ 0 + target</span></span>
<span><span class="co">##          top ~ 0 + target</span></span>
<span><span class="co">##          bottom ~ 0 + target</span></span>
<span><span class="co">##    Data: data (Number of observations: 3003) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 8000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## ec50_target1ahw       1.70      0.11     1.45     1.87 1.00     4597     2714</span></span>
<span><span class="co">## ec50_target1jps       1.37      0.13     1.07     1.60 1.00     4199     3043</span></span>
<span><span class="co">## ec50_target1mlc       2.39      0.52     0.96     3.17 1.00     2741     2016</span></span>
<span><span class="co">## ec50_target1ztx       0.75      0.08     0.59     0.89 1.00     5111     3856</span></span>
<span><span class="co">## ec50_target2aep       1.11      0.25     0.58     1.51 1.00     4927     3196</span></span>
<span><span class="co">## ec50_target2jel       1.65      0.06     1.53     1.76 1.00     5928     5263</span></span>
<span><span class="co">## hill_target1ahw       1.69      0.43     0.91     2.62 1.00     3637     2596</span></span>
<span><span class="co">## hill_target1jps       1.50      0.37     0.88     2.30 1.00     3547     3000</span></span>
<span><span class="co">## hill_target1mlc       1.05      0.55     0.27     2.29 1.00     2972     2934</span></span>
<span><span class="co">## hill_target1ztx       2.72      0.55     1.76     3.91 1.00     6168     5216</span></span>
<span><span class="co">## hill_target2aep       2.00      0.66     0.75     3.36 1.00     4343     2235</span></span>
<span><span class="co">## hill_target2jel       3.19      0.58     2.13     4.41 1.00     7193     5504</span></span>
<span><span class="co">## top_target1ahw      -10.57      0.67   -11.59    -8.95 1.00     4882     2870</span></span>
<span><span class="co">## top_target1jps       -9.69      0.59   -10.63    -8.31 1.00     4673     3178</span></span>
<span><span class="co">## top_target1mlc       -1.42      5.83    -9.88    12.31 1.00     6140     4915</span></span>
<span><span class="co">## top_target1ztx      -17.44      0.28   -17.99   -16.89 1.00     9799     5483</span></span>
<span><span class="co">## top_target2aep      -16.33      0.47   -16.94   -15.47 1.00     5453     2790</span></span>
<span><span class="co">## top_target2jel      -11.09      0.34   -11.73   -10.41 1.00     8342     5971</span></span>
<span><span class="co">## bottom_target1ahw   -25.95      2.09   -31.02   -23.10 1.00     3745     2320</span></span>
<span><span class="co">## bottom_target1jps   -30.53      3.80   -39.70   -24.89 1.00     3415     2998</span></span>
<span><span class="co">## bottom_target1mlc   -18.38      4.30   -31.43   -14.75 1.00     2561     2009</span></span>
<span><span class="co">## bottom_target1ztx   -38.76      3.46   -46.52   -32.95 1.00     5696     4004</span></span>
<span><span class="co">## bottom_target2aep   -30.40      6.00   -44.30   -21.31 1.00     7151     4817</span></span>
<span><span class="co">## bottom_target2jel   -19.45      0.97   -21.52   -17.75 1.00     6116     4923</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## sigma     5.74      0.07     5.60     5.89 1.00     9878     5783</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre>
<p>Excitingly, using leave-one-out cross-validation, the sigmoid model
fits the data very well</p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Computed from 8000 by 3003 log-likelihood matrix.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##          Estimate   SE</span></span>
<span><span class="co">## elpd_loo  -9521.3 39.0</span></span>
<span><span class="co">## p_loo        21.5  1.1</span></span>
<span><span class="co">## looic     19042.6 78.0</span></span>
<span><span class="co">## ------</span></span>
<span><span class="co">## MCSE of elpd_loo is 0.1.</span></span>
<span><span class="co">## MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.6]).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All Pareto k estimates are good (k &lt; 0.7).</span></span>
<span><span class="co">## See help('pareto-k-diagnostic') for details.</span></span></code></pre>
<p>Visualize the fit as draws from the expected mean and median quantile
intvervals on the log(RMSD) scale:</p>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_model_Pnear_files/plot-data-model-1.png" alt="plot of chunk plot-data-model" width="100%"><p class="caption">
plot of chunk plot-data-model
</p>
</div>
<p>And on the original RMSD scale:</p>
<div class="figure" style="text-align: center">
<img src="apply_sigmoid_model_Pnear_files/plot-data-model-rmsd-1.png" alt="plot of chunk plot-data-model-rmsd" width="100%"><p class="caption">
plot of chunk plot-data-model-rmsd
</p>
</div>
<div class="section level3">
<h3 id="quantify-pnear-uncertainty">Quantify Pnear uncertainty<a class="anchor" aria-label="anchor" href="#quantify-pnear-uncertainty"></a>
</h3>
<p>Using the two-state model fit, it is possible to propagate the
posterior uncertainty to estimate the uncertainty of the Pnear.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Madeline Martin, Matthew O’Meara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
